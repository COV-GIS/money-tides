import{_ as S,b as v}from"./money-tides-jsxFactory-BuZJ-lxl.js";import"./money-tides-config-Dy31BTur.js";import{f as D,d as E}from"./money-tides-dataUtils-C_oGSDms.js";import{eh as z,hm as y,hn as $,ho as b}from"./money-tides-app-config-MxvE8nSP.js";import"./index-BFGaZejD.js";import"./money-tides-index-Bz5uSspo.js";import"./money-tides-runtime-BTGwkf2p.js";import"./money-tides-ReactiveMap-JW3-N2B-.js";import"./money-tides-messageBundle-C4FYXWhM.js";import"./money-tides-index-BSQMl5Dg.js";function T(e,r,t){const{extent:i,valid:u}=e,[n,s,a,o]=i;return!(t<s||t>o)&&(u!=null&&n>a?r>=a||r<=n:r>=n&&r<=a)}function j(e,r,t,i){const{extent:u,modelSize:n,valid:s}=e,[a,o,c]=u,f=k(a,c,s);let l=r/n[0]*f+a;return s!=null&&i&&(l=new z(s[0],s[1]).normalize(l)),[l,(n[1]-t)/n[1]*y(u)+o]}function k(e,r,t){if(t!=null&&e>r){const[i,u]=t;return u-e+(r-i)}return r-e}function A(e){return e?4:3}function F(e,r,t){const[i,u]=t.modelSize;let n=null;const s=new Map;r.forEach(o=>{s.set(o.lij,D(e,o))});const a=(o,c,f)=>$(o.extent,c,f);return(o,c)=>{const f=Math.round(o),l=Math.round(c);if(!e.wrapAround&&(f<0||f>=i||l<0||l>=u))return[0,0];const[d,m]=j(t,o,c,!0);if(!T(t,d,m))return[0,0];if(n==null||!a(n,d,m)){n=null;for(const[I,x]of r)if(a(x,d,m)){n=x;break}}if(n?.data==null)return[0,0];const g=s.get(n.lij);if(g==null)return[0,0];const{width:M,height:w,extent:p}=n;return g((d-p[0])/b(p)*M,w-(m-p[1])/y(p)*w)}}let h=class{constructor(){this._tileData=new Map}async generateStreamlines(e){const{flowData:r,flowExtentInfo:t,needsMagnitude:i,simulationSettings:u,startPositions:n}=e,s=_(D(u,r),u,t.modelSize,i,n);return{result:{streamlines:s},transferList:s?.map(a=>a.vertices.buffer)}}async generateTiledStreamlines(e){const{flowDataTiles:r,flowExtentInfo:t,needsMagnitude:i,reset:u,simulationSettings:n,startPositions:s}=e;this._updateTileData(r,u);const a=_(F(n,this._tileData,t),n,t.modelSize,i,s);return{result:{streamlines:a},transferList:a?.map(o=>o.vertices.buffer)??[]}}_updateTileData(e,r){r&&this._tileData.forEach((t,i)=>{e.get(i)==null&&this._tileData.delete(i)}),e.forEach((t,i)=>{t.type==="delete"?this._tileData.delete(i):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(i,t.data)})}};h=S([v("esri.views.3d.support.flow.FlowWorker")],h);const N=h;function _(e,r,t,i,u){if(e==null)return;const n=E(r,e,t[0],t[1],{positions:u}),s=[],a=A(i);for(const{vertices:o,stage:c}of n){const f=new Float32Array(o.length*a);for(let l=0;l<o.length;l++)f[l*a]=o[l].x,f[l*a+1]=o[l].y,f[l*a+2]=o[l].t,i&&(f[l*a+3]=o[l].speed);s.push({vertices:f,stage:c,hasMagnitude:i})}return s}export{N as default};
