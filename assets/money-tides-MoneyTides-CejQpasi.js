const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/money-tides-TrafficCameraDialog-DblxYs4I.js","assets/money-tides-jsxFactory-C_VNtWho.js","assets/money-tides-config-BVnrMf5g.js","assets/index-DrjIDhyp.js","assets/index-CEPnQygF.css","assets/money-tides-index-Bz5uSspo.js","assets/money-tides-runtime-BTGwkf2p.js","assets/runtime-OCMtRbrJ.css","assets/money-tides-app-config-c6vRzV27.js","assets/money-tides-ReactiveMap-wsdEhGtW.js","assets/money-tides-messageBundle-CtjrMz3Y.js","assets/money-tides-index-BSQMl5Dg.js","assets/TrafficCameraDialog-CgGXLGGQ.css","assets/money-tides-DeclinationAction-S3xasfDh.js","assets/DeclinationAction-CtJPH1yU.css","assets/money-tides-FullscreenAction-CHe_wT64.js","assets/money-tides-SettingsAction-CY22u6w7.js","assets/SettingsAction-CESW0KY9.css","assets/money-tides-AttributionAction-Dca8_bOp.js","assets/AttributionAction-DmMpU9qe.css","assets/money-tides-AboutAction-kE8PJiOK.js","assets/money-tides-LayersPanel-B3Wojedk.js","assets/money-tides-PanelBase-BWWRNijE.js","assets/money-tides-AdvisoriesPanel-DWzCggNh.js","assets/AdvisoriesPanel-DCuVDuTP.css","assets/money-tides-LunarPhasePanel-DLhYvTlC.js","assets/LunarPhasePanel-BnAYxmrE.css","assets/money-tides-TidesDialog-Ca255wk6.js","assets/TidesDialog-yUcdXs_A.css","assets/money-tides-PlotDialog-DocSBBey.js"])))=>i.map(i=>d[i]);
import{_ as I}from"./index-DrjIDhyp.js";import{aj as G,aD as Nt,N as wt,aE as m,m as Jt,c as Gt}from"./money-tides-jsxFactory-C_VNtWho.js";import"./money-tides-config-BVnrMf5g.js";import{l4 as Et,c5 as Tt,he as At,bg as Mt,af as ut,e9 as O,_ as Bt,ah as et,gx as Dt,kD as nt,kC as ot,e7 as L,l5 as Ft,l6 as St,l7 as Vt}from"./money-tides-app-config-c6vRzV27.js";var ht={exports:{}},Pt;function Wt(){return Pt||(Pt=1,(function(t,e){(function(){var a=Math.PI,n=Math.sin,o=Math.cos,i=Math.tan,s=Math.asin,d=Math.atan2,h=Math.acos,u=a/180,f=1e3*60*60*24,_=2440588,p=2451545;function b(r){return r.valueOf()/f-.5+_}function E(r){return new Date((r+.5-_)*f)}function T(r){return b(r)-p}var D=u*23.4397;function S(r,l){return d(n(r)*o(D)-i(l)*n(D),o(r))}function P(r,l){return s(n(l)*o(D)+o(l)*n(D)*n(r))}function B(r,l,c){return d(n(r),o(r)*n(l)-i(c)*o(l))}function H(r,l,c){return s(n(l)*n(c)+o(l)*o(c)*o(r))}function k(r,l){return u*(280.16+360.9856235*r)-l}function C(r){return r<0&&(r=0),2967e-7/Math.tan(r+.00312536/(r+.08901179))}function F(r){return u*(357.5291+.98560028*r)}function Y(r){var l=u*(1.9148*n(r)+.02*n(2*r)+3e-4*n(3*r)),c=u*102.9372;return r+l+c+a}function yt(r){var l=F(r),c=Y(l);return{dec:P(c,0),ra:S(c,0)}}var z={};z.getPosition=function(r,l,c){var v=u*-c,y=u*l,w=T(r),g=yt(w),M=k(w,v)-g.ra;return{azimuth:B(M,y,g.dec),altitude:H(M,y,g.dec)}};var dt=z.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];z.addTime=function(r,l,c){dt.push([r,l,c])};var gt=9e-4;function Rt(r,l){return Math.round(r-gt-l/(2*a))}function vt(r,l,c){return gt+(r+l)/(2*a)+c}function _t(r,l,c){return p+r+.0053*n(l)-.0069*n(2*c)}function It(r,l,c){return h((n(r)-n(l)*n(c))/(o(l)*o(c)))}function Ht(r){return-2.076*Math.sqrt(r)/60}function jt(r,l,c,v,y,w,g){var M=It(r,c,v),A=vt(M,l,y);return _t(A,w,g)}z.getTimes=function(r,l,c,v){v=v||0;var y=u*-c,w=u*l,g=Ht(v),M=T(r),A=Rt(M,y),$=vt(0,y,A),j=F($),V=Y(j),Z=P(V,0),N=_t($,j,V),W,U,J,R,q,Q,x={solarNoon:E(N),nadir:E(N-.5)};for(W=0,U=dt.length;W<U;W+=1)J=dt[W],R=(J[0]+g)*u,q=jt(R,y,w,Z,A,j,V),Q=N-(q-N),x[J[1]]=E(Q),x[J[2]]=E(q);return x};function bt(r){var l=u*(218.316+13.176396*r),c=u*(134.963+13.064993*r),v=u*(93.272+13.22935*r),y=l+u*6.289*n(c),w=u*5.128*n(v),g=385001-20905*o(c);return{ra:S(y,w),dec:P(y,w),dist:g}}z.getMoonPosition=function(r,l,c){var v=u*-c,y=u*l,w=T(r),g=bt(w),M=k(w,v)-g.ra,A=H(M,y,g.dec),$=d(n(M),i(y)*o(g.dec)-n(g.dec)*o(M));return A=A+C(A),{azimuth:B(M,y,g.dec),altitude:A,distance:g.dist,parallacticAngle:$}},z.getMoonIllumination=function(r){var l=T(r||new Date),c=yt(l),v=bt(l),y=149598e3,w=h(n(c.dec)*n(v.dec)+o(c.dec)*o(v.dec)*o(c.ra-v.ra)),g=d(y*n(w),v.dist-y*o(w)),M=d(o(c.dec)*n(c.ra-v.ra),n(c.dec)*o(v.dec)-o(c.dec)*n(v.dec)*o(c.ra-v.ra));return{fraction:(1+o(g))/2,phase:.5+.5*g*(M<0?-1:1)/Math.PI,angle:M}};function X(r,l){return new Date(r.valueOf()+l*f/24)}z.getMoonTimes=function(r,l,c,v){var y=new Date(r);v?y.setUTCHours(0,0,0,0):y.setHours(0,0,0,0);for(var w=.133*u,g=z.getMoonPosition(y,l,c).altitude-w,M,A,$,j,V,Z,N,W,U,J,R,q,Q,x=1;x<=24&&(M=z.getMoonPosition(X(y,x),l,c).altitude-w,A=z.getMoonPosition(X(y,x+1),l,c).altitude-w,V=(g+A)/2-M,Z=(A-g)/2,N=-Z/(2*V),W=(V*N+Z)*N+M,U=Z*Z-4*V*M,J=0,U>=0&&(Q=Math.sqrt(U)/(Math.abs(V)*2),R=N-Q,q=N+Q,Math.abs(R)<=1&&J++,Math.abs(q)<=1&&J++,R<-1&&(R=q)),J===1?g<0?$=x+R:j=x+R:J===2&&($=x+(W<0?q:R),j=x+(W<0?R:q)),!($&&j));x+=2)g=A;var tt={};return $&&(tt.rise=X(y,$)),j&&(tt.set=X(y,j)),!$&&!j&&(tt[W>0?"alwaysUp":"alwaysDown"]=!0),tt},t.exports=z})()})(ht)),ht.exports}var K=Wt();const kt=(t,e)=>{const a=new URL(t);return Object.entries(e).forEach(([n,o])=>{a.searchParams.append(n,String(o))}),a.toString()},Ct=t=>{const e=Number(pt(t).toFixed(0));return e===0?"South":e===90?"West":e===-90?"East":e===180||e===-180?"North":e>0&&e<90?`S ${e}° W`:e>90?`N ${e-90}° W`:e<0&&e>-90?`S ${Math.abs(e)}° E`:e<-90?`N ${Math.abs(e)-90}° E`:"invalid azimuth"},oe=async(t,e,a)=>{try{const n=kt("https://www.ngdc.noaa.gov/geomag-web/calculators/calculateDeclination",{key:"zNEw7",lat1:e,lon1:a,model:"WMM",startYear:t.get("year"),startMonth:t.get("month"),startDay:t.get("day"),resultFormat:"json"}),i=(await(await fetch(n)).json()).result[0].declination,s=Math.abs(i),d=i>0?"E":"W";return{bearing:i===0?"0°":`${Math.floor(s)}° ${Math.floor((s-Math.floor(s))*60)}' ${d}`,declination:i}}catch(n){return console.log(n),{bearing:"invalid",declination:-999}}},qt=t=>t<=.05?"New Moon":t>.05&&t<.2?"Waxing Crescent":t>=.2&&t<=.3?"First Quarter":t>.3&&t<.45?"Waxing Gibbous":t>=.45&&t<=.55?"Full Moon":t>.55&&t<.7?"Waning Gibbous":t>=.7&&t<=.8?"Last Quarter":t>.8?"Waning Crescent":"Invalid Phase",pt=t=>t*180/Math.PI,it=(t,e,a)=>{const n=t.toJSDate(),{rise:o,set:i}=K.getMoonTimes(n,e,a),{distance:s}=K.getMoonPosition(n,e,a),{fraction:d,phase:h}=K.getMoonIllumination(n),{nadir:u,solarNoon:f,sunrise:_,sunset:p}=K.getTimes(n,e,a);return{moon:{distance:s,distanceFromAverage:-(s-384400),illumination:d,illuminationPercent:`${(d*100).toFixed(0)}%`,moonrise:o?G.fromJSDate(o):void 0,moonset:i?G.fromJSDate(i):void 0,phase:h,phaseName:qt(h)},sun:{nadir:G.fromJSDate(u),solarNoon:G.fromJSDate(f),sunrise:G.fromJSDate(_),sunset:G.fromJSDate(p)}}},at=(t,e,a)=>{const n=t.toJSDate(),{moon:{moonrise:o,moonset:i},sun:{sunrise:s,sunset:d}}=it(t,e,a),{altitude:h,azimuth:u}=K.getMoonPosition(n,e,a),{altitude:f,azimuth:_}=K.getPosition(n,e,a),p=t.toMillis(),b=o&&p===o.toMillis()||i&&p===i.toMillis(),E=p===s.toMillis()||p===d.toMillis(),T=pt(h),D=pt(f);return{moonPosition:{aboveHorizon:b?!0:h>0,altitude:T,altitudeDegrees:b?"0°":`${T.toFixed(0)}°`,azimuth:u,azimuthBearing:Ct(u),type:"moon"},sunPosition:{aboveHorizon:E?!0:f>0,altitude:D,altitudeDegrees:E?"0°":`${D.toFixed(0)}°`,azimuth:_,azimuthBearing:Ct(_),type:"sun"}}},Yt="M10.5 7.095h-.008a6.76 6.76 0 0 0-.848.108c-.022-.471-.41-1.05-.887-1.05a.892.892 0 0 0-.892.892.883.883 0 0 0 .139.467 5.507 5.507 0 0 0-1.13.678.153.153 0 0 0-.064-.136c-.015-.01-1.377-.948-1.336-2.065a3.838 3.838 0 0 0 2.502-.523c.361-.286.867-.675.912-1.158a.155.155 0 0 0-.21-.159 8.942 8.942 0 0 1-2.167.409 4.498 4.498 0 0 1 1.95-2.225.173.173 0 0 0 .097-.165.155.155 0 0 0-.137-.134c-.14-.016-3.642.64-4.108 2.533-.494 2.005.206 2.911.248 2.963l1.59 1.367a4.28 4.28 0 0 0-.482.737c-.422-.206-1.94-.811-2.118-1.435a12.964 12.964 0 0 1-.92-2.796.152.152 0 0 0-.162-.12.155.155 0 0 0-.144.14 8.124 8.124 0 0 0 .197 3.46c.054.07 1.829 1.601 3.075 1.668.032.14.074.496.128.662-.493-.118-1.837-.433-2.373-.487a.15.15 0 0 0-.153.08 12.457 12.457 0 0 0-1.17 2.863 5.375 5.375 0 0 0 .002 1.201.155.155 0 0 0 .13.128l.023.001a.155.155 0 0 0 .139-.087l1.482-3.042a19.099 19.099 0 0 0 2.418.422h.005a4.8 4.8 0 0 0 .23.337 4.961 4.961 0 0 0-1.987.747 2.575 2.575 0 0 0-.544 1.912c0 .876 1.259 1.618 1.436 1.655a.16.16 0 0 0 .031.003.155.155 0 0 0 .107-.267 3.57 3.57 0 0 1-.74-1.523 3.68 3.68 0 0 1 .221-.943l2.13-.775a.151.151 0 0 0 .07-.052 4.608 4.608 0 0 0 .59.41L6.33 15.064a.155.155 0 0 0-.04.178c.033.076 1.222 2.465 2.265 2.605a3.554 3.554 0 0 0 .625.075 3.156 3.156 0 0 0 .474-.028.155.155 0 0 0 .042-.292 6.336 6.336 0 0 1-1.895-1.837l-.154-.36 1.09-1.171a6.87 6.87 0 0 0 1.763.337 6.87 6.87 0 0 0 1.763-.337l1.09 1.171-.154.36a6.336 6.336 0 0 1-1.895 1.837.155.155 0 0 0 .042.292 3.156 3.156 0 0 0 .474.028 3.554 3.554 0 0 0 .625-.075c1.043-.14 2.232-2.529 2.265-2.605a.155.155 0 0 0-.04-.178l-1.443-1.268a4.608 4.608 0 0 0 .592-.41.151.151 0 0 0 .069.052l2.13.775a3.68 3.68 0 0 1 .221.943 3.57 3.57 0 0 1-.74 1.523.155.155 0 0 0 .107.267.16.16 0 0 0 .03-.003c.178-.037 1.437-.779 1.437-1.655a2.575 2.575 0 0 0-.544-1.912 4.961 4.961 0 0 0-1.987-.747 4.8 4.8 0 0 0 .23-.337h.005a19.099 19.099 0 0 0 2.418-.422l1.482 3.042a.155.155 0 0 0 .14.087l.022-.001a.155.155 0 0 0 .13-.128 5.375 5.375 0 0 0 .002-1.2 12.457 12.457 0 0 0-1.17-2.863.15.15 0 0 0-.153-.081c-.536.054-1.88.369-2.373.487.054-.166.096-.521.128-.662 1.246-.067 3.02-1.598 3.075-1.668a8.124 8.124 0 0 0 .197-3.46.155.155 0 0 0-.144-.14.152.152 0 0 0-.162.12 12.964 12.964 0 0 1-.92 2.796c-.178.624-1.696 1.23-2.118 1.435a4.28 4.28 0 0 0-.483-.737l1.59-1.367c.043-.052.743-.958.25-2.963-.467-1.893-3.97-2.549-4.11-2.533a.155.155 0 0 0-.136.134.173.173 0 0 0 .098.165 4.498 4.498 0 0 1 1.95 2.225 8.942 8.942 0 0 1-2.168-.409.155.155 0 0 0-.21.16c.045.482.55.871.912 1.157a3.838 3.838 0 0 0 2.502.523c.04 1.117-1.321 2.056-1.336 2.065a.153.153 0 0 0-.065.136 5.507 5.507 0 0 0-1.129-.678.883.883 0 0 0 .139-.467.892.892 0 0 0-.892-.891c-.477 0-.865.578-.887 1.05a6.76 6.76 0 0 0-.848-.109z",Ot=new Tt({size:12,outline:{width:0},path:Yt}),lt=new Tt({style:"circle",size:18,outline:{width:1}}),Lt=new At({font:{size:12},haloSize:1.75,horizontalAlignment:"left",verticalAlignment:"middle",xoffset:12}),xt=new At({font:{size:12},haloSize:1.75,horizontalAlignment:"left",verticalAlignment:"top",xoffset:12,yoffset:-9}),Zt=t=>{const{money:e,name:a,tides:n}=t,{primary:o,secondary:i}=Et(e),s=Object.assign(Ot.clone(),{color:o}),d=Object.assign(lt.clone(),{color:i,outline:{color:o,width:lt.outline.width}}),h=Object.assign(Lt.clone(),{color:o,haloColor:i,text:a}),u=Object.assign(xt.clone(),{color:o,haloColor:i,text:zt(n)});return{crabSymbol:s,markerSymbol:d,stationSymbol:h,tidesSymbol:u}},zt=t=>t.filter(e=>e.isPrediction&&e.isDate).map(e=>{const{heightLabel:a,time:n,type:o}=e;return`${n} ${o} ${a}`}).join(`
`),Ut=t=>{const{error:e,money:a,name:n,tides:o}=t;let{primary:i,secondary:s}=Et(a);e&&(i=new Mt("black"),s=new Mt("white"));const d=Object.assign(Ot.clone(),{color:i}),h=Object.assign(lt.clone(),{color:s,outline:{color:i,width:lt.outline.width}}),u=Object.assign(Lt.clone(),{color:i,haloColor:s,text:n}),f=Object.assign(xt.clone(),{color:e?null:i,haloColor:e?null:s,text:zt(o)});return{crabSymbol:d,markerSymbol:h,stationSymbol:u,tidesSymbol:f}};var Qt=Object.defineProperty,Kt=Object.getOwnPropertyDescriptor,$t=(t,e,a,n)=>{for(var o=n>1?void 0:n?Kt(e,a):e,i=t.length-1,s;i>=0;i--)(s=t[i])&&(o=(n?s(e,a,o):s(o))||o);return n&&o&&Qt(e,a,o),o};const st=(t,e)=>{const a=t.filter(b=>b.isPrediction),n=-999;let o;if(a.forEach(b=>{b.date.toMillis()<e.toMillis()&&(o=b)}),!o)return n;const i=a[a.indexOf(o)+1];if(!i)return n;const{date:s,height:d}=o,{date:h,height:u}=i,f=s.toMillis(),_=h.toMillis(),p=e.toMillis();return p<f&&p<_||p>f&&p>_?n:Number((d+(u-d)*(p-f)/(_-f)).toFixed(2))},rt="money-tides",mt={header:`${rt}_header`,headerDate:`${rt}_header--date`,view:`${rt}_view`};let ft=0,ct=class extends Nt{constructor(t){super(t),this._container=document.createElement("calcite-shell"),this.alerts=new ut,this.panelHideMethods=[],this.stations=new ut,this.visiblePanel=null,this.zoomToDropdownItems=new ut,this.container=this._container,document.body.appendChild(this.container);const{zoomToDropdownItems:e}=this;this.addHandles([wt(()=>L.colorType,()=>{this.stations.forEach(this.updateGraphics.bind(this))}),e.on("after-add",()=>{e.sort((a,n)=>a.name<n.name?-1:a.name>n.name?1:0)})])}get container(){return this._container}set container(t){this._container=t}addZoomToItem(t,e){this.zoomToDropdownItems.add({name:e,element:m("calcite-dropdown-item",{"icon-start":"pin-tear",key:ft++,onclick:()=>{const a=this.stations.find(n=>n.id===t);a&&(O.goTo(a.graphics.markerGraphic),O.scale=6e4,this.tidesDialog.open(a))}},e)})}createGraphics(t){const{graphics:e}=O,{id:a,latitude:n,longitude:o,money:i,name:s,tides:d}=t,{crabSymbol:h,markerSymbol:u,stationSymbol:f,tidesSymbol:_}=Zt({money:i,name:s,tides:d}),p={id:a},b=new Bt({latitude:n,longitude:o}),E=new et({attributes:p,geometry:b,symbol:h}),T=new et({attributes:p,geometry:b,symbol:u}),D=new et({attributes:p,geometry:b,symbol:f}),S=new et({attributes:p,geometry:b,symbol:_,visible:O.scale<24e4});return this.addHandles(wt(()=>O.scale,()=>{S.visible=O.scale<24e4})),e.addMany([T,E,D,S]),{crabGraphic:E,markerGraphic:T,stationGraphic:D,tidesGraphic:S}}async getTides(t){const{date:e,id:a,latitude:n,longitude:o}=t,i=e.minus({day:1}),s=e.plus({day:1}),h=(await(await fetch(kt("https://api.tidesandcurrents.noaa.gov/api/prod/datagetter",{product:"predictions",format:"json",interval:"hilo",time_zone:"lst_ldt",units:"english",datum:"mllw",station:a,begin_date:Dt(i),end_date:Dt(s)}))).json()).predictions.map(S=>{const{t:P,v:B,type:H}=S,k=G.fromSQL(P).setZone("America/Los_Angeles"),C=Number(Number(B).toFixed(2));return{date:k,height:C,heightLabel:`${C} ft`,isDate:e.hasSame(k,"day"),isLunar:!1,isPrediction:!0,isSolar:!1,money:"not-money",...at(k,n,o),time:nt(k),type:H==="H"?"high tide":"low tide"}}),u=this.money(h),{moon:f,sun:_}=it(i,n,o),{moon:p,sun:b}=it(e,n,o),{moon:E,sun:T}=it(s,n,o),D=[{date:_.nadir,event:"solar nadir",type:"solar"},{date:_.solarNoon,event:"solar noon",type:"solar"},{date:_.sunrise,event:"sunrise",type:"solar"},{date:_.sunset,event:"sunset",type:"solar"},{date:b.nadir,event:"solar nadir",type:"solar"},{date:b.solarNoon,event:"solar noon",type:"solar"},{date:b.sunrise,event:"sunrise",type:"solar"},{date:b.sunset,event:"sunset",type:"solar"},{date:T.nadir,event:"solar nadir",type:"solar"},{date:T.solarNoon,event:"solar noon",type:"solar"},{date:T.sunrise,event:"sunrise",type:"solar"},{date:T.sunset,event:"sunset",type:"solar"}];return f.moonrise&&D.push({date:f.moonrise,event:"moonrise",type:"lunar"}),f.moonset&&D.push({date:f.moonset,event:"moonset",type:"lunar"}),p.moonrise&&D.push({date:p.moonrise,event:"moonrise",type:"lunar"}),p.moonset&&D.push({date:p.moonset,event:"moonset",type:"lunar"}),E.moonrise&&D.push({date:E.moonrise,event:"moonrise",type:"lunar"}),E.moonset&&D.push({date:E.moonset,event:"moonset",type:"lunar"}),D.forEach(S=>{const{date:P,event:B,type:H}=S,k=st(h,P);h.push({date:P,height:k,heightLabel:`${k} ft`,isDate:e.hasSame(P,"day"),isLunar:H==="lunar",isPrediction:!1,isSolar:H==="solar",money:"not-money",...at(P,n,o),time:nt(P),type:B})}),h.sort((S,P)=>S.date.toMillis()-P.date.toMillis()),h.filter(S=>S.isLunar).forEach((S,P,B)=>{const{date:H,type:k}=S;let C,F;if(k==="moonrise"){const Y=B[P+1];Y&&(C=G.fromMillis(Math.floor((H.toMillis()+Y.date.toMillis())/2)),F=st(h,C),h.push({date:C,height:F,heightLabel:`${F} ft`,isDate:e.hasSame(C,"day"),isLunar:!0,isPrediction:!1,isSolar:!1,money:"not-money",...at(C,n,o),time:nt(C),type:"lunar noon"}))}if(k==="moonset"){const Y=B[P+1];Y&&(C=G.fromMillis(Math.floor((H.toMillis()+Y.date.toMillis())/2)),F=st(h,C),h.push({date:C,height:F,heightLabel:`${F} ft`,isDate:e.hasSame(C,"day"),isLunar:!0,isPrediction:!1,isSolar:!1,money:"not-money",...at(C,n,o),time:nt(C),type:"lunar nadir"}))}}),h.sort((S,P)=>S.date.toMillis()-P.date.toMillis()),{money:u,moon:p,sun:b,tides:h}}getTimeRange(t){if(!t)return 0;const e=t.toMillis();return e>=ot(t,{hour:11}).toMillis()&&e<=ot(t,{hour:13}).toMillis()?2:e>=ot(t,{hour:10}).toMillis()&&e<=ot(t,{hour:14}).toMillis()?1:0}async loadStation(t){try{const{id:e,latitude:a,longitude:n,name:o,weather:i}=t,s=L.date,{money:d,moon:h,sun:u,tides:f}=await this.getTides({date:s,id:e,latitude:a,longitude:n});this.stations.add({date:s,error:!1,errorCount:0,graphics:this.createGraphics({id:e,latitude:a,longitude:n,money:d,name:o,tides:f}),id:e,latitude:a,longitude:n,name:o,money:d,moon:h,sun:u,tides:f,weather:i}),this.addZoomToItem(e,o),t.loaded=!0}catch(e){if(console.log("load error",e),t.errorCount!==10){t.errorCount++,setTimeout(()=>{this.loadStation(t)},t.errorCount*50);return}const a=`station-error-alert-${t.id}`,n=this.container.querySelector(`#${a}`);if(n){n.open=!0;return}this.alerts.add(m("calcite-alert",{"auto-close":"","auto-close-duration":"fast",icon:"exclamation-mark-triangle",id:a,key:ft++,kind:"danger",open:!0,scale:L.scale,slot:"alerts"},m("div",{slot:"title"},"Error"),m("div",{slot:"message"},"Failed to load station data for ",t.name)))}}money(t){const e=t.filter(s=>s.isDate).toSorted((s,d)=>d.height-s.height),a=e[0],n=e[1].type==="high tide"?e[1]:null,o=this.getTimeRange(a.date),i=this.getTimeRange(n?.date);return o===2?(t[t.indexOf(a)].money="money","money"):o===1?(t[t.indexOf(a)].money="mostly-money","mostly-money"):i===2&&n?(t[t.indexOf(n)].money="kinda-money","kinda-money"):i===1&&n?(t[t.indexOf(n)].money="potentially-money","potentially-money"):"not-money"}updateGraphics(t){const{error:e,graphics:{crabGraphic:a,markerGraphic:n,stationGraphic:o,tidesGraphic:i},money:s,name:d,tides:h}=t,{crabSymbol:u,markerSymbol:f,stationSymbol:_,tidesSymbol:p}=Ut({error:e,money:s,name:d,tides:h});a.symbol=u,n.symbol=f,o.symbol=_,i.symbol=p}async updateStation(t){const{tidesDialog:e}=this,a=L.date,{id:n,latitude:o,longitude:i}=t;try{const{money:s,moon:d,sun:h,tides:u}=await this.getTides({date:a,id:n,latitude:o,longitude:i});Object.assign(t,{date:a,money:s,moon:d,sun:h,tides:u}),t.error=!1,t.errorCount=0,this.updateGraphics(t),e.container.open&&e.station.id===n&&e.open(t);const f=this.container.querySelector(`#station-error-alert-${n}`);f&&(f.open=!1)}catch(s){if(console.log("update error",s),t.error=!0,this.updateGraphics(t),t.errorCount!==10){t.errorCount++,setTimeout(()=>{this.updateStation(t)},t.errorCount*50);return}const d=`station-error-alert-${t.id}`,h=this.container.querySelector(`#${d}`);if(h){h.open=!0;return}t.errorCount=0,e.container.open&&e.station.id===n&&e.close(),this.alerts.add(m("calcite-alert",{"auto-close":"","auto-close-duration":"fast",icon:"exclamation-mark-triangle",id:d,key:ft++,kind:"danger",open:!0,scale:L.scale,slot:"alerts"},m("div",{slot:"title"},"Error"),m("div",{slot:"message"},"Failed to load station data for ",t.name)))}}dateChangeEvent(t){L.date=Ft(G.fromISO(t.target.value).setZone("America/Los_Angeles")),this.stations.forEach(this.updateStation.bind(this))}dateButtonClickEvent(t){const e=t.target.iconStart,a=L.date=e==="chevron-right"?L.date.plus({days:1}):L.date.minus({days:1});this.datePicker.value=a.toISODate(),this.datePicker.dispatchEvent(new Event("calciteInputDatePickerChange"))}actionClickEvent(t){if(!t){for(const e of this.panelHideMethods)e();this.visiblePanel=null;return}if(t&&this.visiblePanel===t){t.hide(),this.visiblePanel=null;return}t&&this.visiblePanel!==t&&this.visiblePanel?.hide(),this.tidesDialog.close(),t.show(),this.visiblePanel=t}async viewClickEvent(t){t.stopPropagation();const{tidesDialog:e}=this,n=(await O.hitTest(t,{include:[O.graphics,St.graphicsLayers.cameras.graphics]})).results[0];if(!n||n.type!=="graphic"){e.close(),this.trafficCameraDialog&&this.trafficCameraDialog.close();return}if(!n.layer){this.trafficCameraDialog&&this.trafficCameraDialog.close();const o=this.stations.find(i=>i.id===n.graphic.attributes.id);if(!o||o&&o.error)return;e.open(o)}if(n.layer===St.graphicsLayers.cameras){if(e.close(),!this.trafficCameraDialog){const o=document.getElementById("traffic-camera-dialog");this.trafficCameraDialog=new(await I(async()=>{const{default:i}=await import("./money-tides-TrafficCameraDialog-DblxYs4I.js");return{default:i}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))).default({container:o})}this.trafficCameraDialog.open(n.graphic.attributes.filename,n.graphic.attributes.title)}this.actionClickEvent(null)}render(){const t=L.scale,{alerts:e,visiblePanel:a,zoomToDropdownItems:n}=this,o=a===this.lunarPhasePanel?"--calcite-shell-panel-min-width: 260px;":"";return m("calcite-shell",{class:rt,"content-behind":""},m("div",{class:mt.header,slot:"header"},m("div",{class:mt.headerDate},m("calcite-button",{"icon-start":"chevron-left",scale:t,onclick:this.dateButtonClickEvent.bind(this)}),m("calcite-input-date-picker",{"overlay-positioning":"fixed",scale:t,afterCreate:this.datePickerAfterCreate.bind(this)}),m("calcite-button",{"icon-start":"chevron-right",scale:t,onclick:this.dateButtonClickEvent.bind(this)}))),m("calcite-shell-panel",{"display-mode":"float-content",position:L.layout,slot:`panel-${L.layout}`,style:o},m("calcite-action-bar",{scale:t,slot:"action-bar",afterCreate:this.actionBarAfterCreate.bind(this)},m("calcite-action-group",null,m("calcite-dropdown",{placement:"left","offset-distance":"10","offset-skidding":"10",scale:t},m("calcite-action",{icon:"zoom-to-object",scale:t,slot:"trigger",text:"Zoom To",onclick:this.actionClickEvent.bind(this,null)}),m("calcite-dropdown-group",{"group-title":"Zoom to","selection-mode":"none"},n.map(i=>i.element).toArray())),m("calcite-action",{active:this.layersPanel===a,icon:"layers",scale:t,text:"Layers",onclick:this.actionClickEvent.bind(this,this.layersPanel)}),m("calcite-action",{active:this.advisoriesPanel===a,icon:"exclamation-mark-triangle",scale:t,text:"Advisories",onclick:this.actionClickEvent.bind(this,this.advisoriesPanel)}),m("calcite-action",{active:this.lunarPhasePanel===a,icon:"moon",scale:t,text:"Lunar Phase",onclick:this.actionClickEvent.bind(this,this.lunarPhasePanel)}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async i=>{new(await I(async()=>{const{default:s}=await import("./money-tides-DeclinationAction-S3xasfDh.js");return{default:s}},__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11,14]))).default({container:i})}})),m("calcite-action-group",{slot:"actions-end"},m("calcite-action",{afterCreate:async i=>{new(await I(async()=>{const{default:s}=await import("./money-tides-FullscreenAction-CHe_wT64.js");return{default:s}},__vite__mapDeps([15,1,2,3,4,5,6,7,8,9,10,11]))).default({container:i})}}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async i=>{new(await I(async()=>{const{default:s}=await import("./money-tides-SettingsAction-CY22u6w7.js");return{default:s}},__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,17]))).default({container:i})}}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async i=>{new(await I(async()=>{const{default:s}=await import("./money-tides-AttributionAction-Dca8_bOp.js");return{default:s}},__vite__mapDeps([18,1,2,3,4,5,6,7,8,9,10,11,19]))).default({container:i})}}),m("calcite-action",{afterCreate:async i=>{new(await I(async()=>{const{default:s}=await import("./money-tides-AboutAction-kE8PJiOK.js");return{default:s}},__vite__mapDeps([20,3,4,1,2,5,6,7,8,9,10,11]))).default({container:i})}}))),m("calcite-panel",{afterCreate:async i=>{const s=this.layersPanel=new(await I(async()=>{const{default:d}=await import("./money-tides-LayersPanel-B3Wojedk.js");return{default:d}},__vite__mapDeps([21,3,4,1,2,5,6,7,22,8,9,10,11]))).default({container:i});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}}),m("calcite-panel",{afterCreate:async i=>{const s=this.advisoriesPanel=new(await I(async()=>{const{default:d}=await import("./money-tides-AdvisoriesPanel-DWzCggNh.js");return{default:d}},__vite__mapDeps([23,3,4,1,2,5,6,7,22,8,9,10,11,24]))).default({container:i});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}}),m("calcite-panel",{afterCreate:async i=>{const s=this.lunarPhasePanel=new(await I(async()=>{const{default:d}=await import("./money-tides-LunarPhasePanel-DLhYvTlC.js");return{default:d}},__vite__mapDeps([25,1,2,3,4,5,6,7,22,8,9,10,11,26]))).default({container:i});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}})),e.toArray(),m("calcite-dialog",{id:"traffic-camera-dialog",slot:"dialogs"}),m("calcite-dialog",{slot:"dialogs",afterCreate:this.tidesDialogAfterCreate.bind(this)}),m("div",{class:mt.view,afterCreate:this.viewAfterCreate.bind(this)}))}actionBarAfterCreate(t){const e=()=>{const a=t.getBoundingClientRect().width;O.padding={...O.padding,right:a}};e(),new ResizeObserver(()=>{e()}).observe(t)}datePickerAfterCreate(t){const e=L.date.toISODate();t.value=e,t.addEventListener("calciteInputDatePickerChange",this.dateChangeEvent.bind(this)),this.datePicker=t}async tidesDialogAfterCreate(t){this.tidesDialog=new(await I(async()=>{const{default:a}=await import("./money-tides-TidesDialog-Ca255wk6.js");return{default:a}},__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,28]))).default({container:t});const e=new(await I(async()=>{const{default:a}=await import("./money-tides-PlotDialog-DocSBBey.js");return{default:a}},__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11]))).default;this.addHandles(this.tidesDialog.on("plot-tides",e.open.bind(e)))}async viewAfterCreate(t){O.container=t,O.ui.remove(["attribution","zoom"]);for(const e of Vt)Object.assign(e,{errorCount:0,loaded:!1}),this.loadStation(e);this.addHandles(O.on("click",this.viewClickEvent.bind(this))),this.emit("loaded")}};$t([Jt()],ct.prototype,"visiblePanel",2);ct=$t([Gt("MoneyTides")],ct);const ae=Object.freeze(Object.defineProperty({__proto__:null,get default(){return ct},tideHeight:st},Symbol.toStringTag,{value:"Module"}));export{ae as M,kt as c,oe as m,it as s,st as t};
