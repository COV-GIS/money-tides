import{v as p,cm as _}from"./money-tides-app-config-ClMBcfMD.js";import{U as C,a4 as v,a5 as y,u as b,a6 as h,a7 as I}from"./money-tides-jsxFactory-B_9qB7yw.js";function w(n,t,s){const o=s?.createCollection?.()??new p,i=s?.recycleItems?new M:null,d=(e,r=0)=>{if(!e?.length)return;const a=o.splice(r,e.length);i?i.processRemoved(e):a.forEach(m)},l=(e,r=0)=>{if(!e?.length)return;const a=[];for(const u of e){const c=i?.use(u);if(c)a.push(c);else{const g=t(u);i?.register(u,g),a.push(g)}}o.addMany(a,r)},f=C(n,"after-splice",({added:e,start:r,removed:a})=>{d(a,r),l(e,r)},{sync:!0,onListenerRemove:e=>d(e.items),onListenerAdd:e=>l(e.items)});return o.addHandles(f),o}class M{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(t){if(!t?.length)return;const{_removedItemCandidates:s}=this;for(const o of t)this._getItem(o)?.markRemoved()&&(s.add(o),this._queueGarbageCollection())}use(t){const s=this._getItem(t);return s&&(s.removed=!1),s?.item}register(t,s){this._originalToMapped.set(t,new R(s))}_getItem(t){return this._originalToMapped.get(t)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:t}=this,s=Array.from(t);t.clear(),s.forEach(o=>this._garbageCollectIfRemoved(o))}_garbageCollectIfRemoved(t){const{_originalToMapped:s}=this,o=this._getItem(t);o?.removed&&(m(o.item),s.delete(t))}}class R{constructor(t){this.item=t,this.removed=!1}markRemoved(){return this.removed=!0,!0}}function m(n){typeof n=="object"&&n&&("destroy"in n&&typeof n.destroy=="function"?n.destroy():v(n))}function T(n,t,s){const o=new p,i=w(n,e=>_(async r=>{const a=await t(e,r);if(y(r))throw m(a),b();return a}),s),d=()=>null,l=async e=>{const r=await e.promise,a=i.indexOf(e);a<0||o.splice(a,1,r)};o.addMany(i.items.map(d));for(const e of i)h(l(e));const f=i.on("after-splice",({added:e,start:r,deleteCount:a})=>{const u=o.splice(r,a);for(const c of u)m(c);if(e?.length){o.addMany(e.map(d),r);for(const c of e)h(l(c))}});return o.addHandles([I(i),f]),o}export{w as c,T as u};
