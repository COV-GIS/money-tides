import{cb as f}from"./money-tides-jsxFactory-DhEmlXtp.js";import{b as x,Q as T,r as M,a as P,f as S,E as V,h as U}from"./money-tides-HUDMaterial.glsl-DITdF-ry.js";import{cp as $,cu as b,j as w,ct as j,a2 as E,ae as h,h0 as I,g2 as L,v as A,ak as B,fO as _,fP as z,f2 as W,aC as C}from"./money-tides-app-config-oTxpbYta.js";import{b as D,v as R}from"./money-tides-sphere-8ijv-Uvr.js";import"./money-tides-glsl-B5bJgrnA.js";import"./money-tides-ShaderBuilder-DyjGwxeJ.js";import{i as N,m as k,v as J,J as Q,_ as q}from"./money-tides-DefaultMaterial-CIML7ly6.js";import"./money-tides-OutputColorHighlightOID.glsl-uJtG2ouL.js";class F{get ray(){return this._ray}get distanceInRenderSpace(){return this.distance==null?null:(b(d,this.ray.direction,this.distance),$(d))}withinDistance(e){return!!v(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!v(this)&&(b(d,this.ray.direction,this.distance),j(e,this.ray.origin,d),!0)}getTransformedNormal(e){return h(m,this.normal),m[3]=0,L(m,m,this.transformation),h(e,m),E(e,e)}constructor(e){this.intersector=4,this.normal=w(),this.transformation=A(),this._ray=D(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=4,R(e,this._ray)}set(e,r,t,s,i,a,o){this.intersector=e,this.distance=t,h(this.normal,s??B),_(this.transformation,i??z),this.target=r,this.drapedLayerOrder=a,this.renderPriority=o}copy(e){R(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,h(this.normal,e.normal),_(this.transformation,e.transformation)}}function v(n){return n?.distance!=null}const d=w(),m=I();class H{constructor(e){this.layerViewUid=e}}class K extends H{constructor(e,r){super(e),this.graphicUid=r}}class X extends K{constructor(e,r,t,s,i){super(e,r),this.layerViewUid=e,this.graphicUid=r,this.triangleNr=t,this.baseBoundingSphere=s,this.numLodLevels=i}}class Y{constructor(e,r,t,s){this.material=e,this.buffer=r,this.numVertices=t,this.boundingInfo=s,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+C}get renderGeometry(){return this}intersect(e,r,t,s,i,a,o,u){const c=this.bufferWriter,l=this.buffer;c.intersect(l,this.material.parameters,null,e,t,s,(g,p,G)=>O(g,p,G,e,r,a,o,i,u))}}class Z{constructor(e){this.engineGeometry=e;const r=this.material,t=this.engineGeometry,s=t.attributes,i=t.boundingInfo,a=r.createBufferWriter(),o=a.layout,u=a.elementCount(s),c=o.createBuffer(u);a.write(null,null,s,null,c,0),this.renderGeometry=new Y(r,c.buffer,u,i)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,r)=>e+W(r.data,r.indices),0)}intersect(e,r,t,s,i,a,o,u){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,t,s,(l,g,p)=>O(l,g,p,e,r,a,o,i,u))}}function O(n,e,r,t,s,i,a,o,u){if(n<0||s&&!s(t.rayBegin,t.rayEnd,n))return;const c=new X(i.layerViewUid,i.graphicUid(o),r,a,u);if((t.results.min.distance==null||n<t.results.min.distance)&&t.results.min.set(3,c,n,e,t.transform.transform),(t.results.max.distance==null||n>t.results.max.distance)&&t.results.max.set(3,c,n,e,t.transform.transform),t.options.store===2){const l=new F(t.results.min.ray);l.set(3,c,n,e,t.transform.transform),t.results.all.push(l)}}let ee=class{constructor(e,r=null){this.geometry=e,this.textures=r}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}};class te{constructor(e,r,t){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=t;const s=f(this.components.map(i=>i.geometry));this.numVertices=s.reduce((i,a)=>i+a.numVertices,0)}}class re{constructor(e){this.levels=e,this.levels.sort((r,t)=>r.minScreenSpaceRadius===t.minScreenSpaceRadius?r.numVertices-t.numVertices:r.minScreenSpaceRadius-t.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const e=[];return this.levels.forEach(r=>r.components.forEach(t=>e.push(t.geometry.material))),f(e)}getTextures(){const e=new Array;return this.levels.forEach(r=>r.components.forEach(t=>{t.textures!=null&&e.push(...t.textures)})),f(e)}getGeometries(){const e=new Array;return this.levels.forEach(r=>r.components.forEach(t=>{e.push(t.geometry)})),f(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),r=this.getTextures(),t=e.reduce((s,i)=>s+i.computeUsedMemory(),0);return r.reduce((s,i)=>s+i.usedMemory,0)+t}}function he(n){switch(n){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function de(n,e){const r=(t,s,i=!1)=>new re(t.map(a=>{const o=s(a.tesselation);return i&&x(o),new te([new ee(new Z(o))],a.minScreenSpaceRadius)}));switch(n){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],t=>U(e,.5,t));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>V(e,1));case"cone":return r(y,t=>S(e,1,.5,t,!1),!0);case"inverted-cone":return r(y,t=>S(e,1,.5,t,!0),!0);case"cylinder":return r(y,t=>P(e,1,.5,t,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>M(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>T(e,1),!0);default:return}}const y=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],fe=Object.freeze(Object.defineProperty({__proto__:null,build:N},Symbol.toStringTag,{value:"Module"})),ge=Object.freeze(Object.defineProperty({__proto__:null,build:k,getRadius:J},Symbol.toStringTag,{value:"Module"})),pe=Object.freeze(Object.defineProperty({__proto__:null,build:Q},Symbol.toStringTag,{value:"Module"})),ye=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));export{pe as D,ye as R,he as S,te as a,fe as b,re as c,ge as d,F as f,de as l,ee as m,Z as o};
