import{hi as U,b as q,hj as O,aA as E,B as I}from"./index-B5rfF_Rz.js";function _(a){return a&&a.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function x(a){return a!=null&&!isNaN(a)&&isFinite(a)}function A(a){return a.valueExpression?"expression":a.field&&typeof a.field=="string"?"field":"unknown"}function $(a,l){const n=l||A(a),e=a.valueUnit||"unknown";return n==="unknown"?"constant":a.stops?"stops":a.minSize!=null&&a.maxSize!=null&&a.minDataValue!=null&&a.maxDataValue!=null?"clamped-linear":e==="unknown"?a.minSize!=null&&a.minDataValue!=null?a.minSize&&a.minDataValue?"proportional":"additive":"identity":"real-world-size"}const D=()=>q.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=a=>D().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${a}`),z=()=>D().error("Use of arcade expressions requires an arcade context"),k=new I,g=Math.PI,Z=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(a,l,n){const e="visualVariables"in a?a.visualVariables?.find(u=>u.type==="color"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void y("ColorVariable");const t=typeof l=="number",r=t?null:l,s=r?.attributes;let o=t?l:null;const i=e.field,{ipData:c,hasExpression:v}=e.cache;let f=e.cache.compiledFunc;if(!i&&!v){const u=e.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(v){if(n?.arcade==null)return void z();const u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},p=n.arcade.arcadeUtils,h=p.getViewInfo(u),V=p.createExecContext(r,h,n.timeZone);if(!f){const w=p.createSyntaxTree(e.valueExpression);f=p.createFunction(w),e.cache.compiledFunc=f}o=p.executeFunction(f,V)}else s&&(o=s[i]);const d=e.normalizationField,m=s!=null&&d!=null?parseFloat(s[d]):void 0;if(o!=null&&(!d||t||!isNaN(m)&&m!==0)){x(m)&&!t&&(o/=m);const u=F(o,c);if(u){const p=u[0],h=u[1],V=p===h?e.stops[p].color:E.blendColors(e.stops[p].color,e.stops[h].color,u[2],n?.color);return new E(V)}}}function R(a,l,n){const e="visualVariables"in a?a.visualVariables?.find(u=>u.type==="opacity"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void y("OpacityVariable");const t=typeof l=="number",r=t?null:l,s=r?.attributes;let o=t?l:null;const i=e.field,{ipData:c,hasExpression:v}=e.cache;let f=e.cache.compiledFunc;if(!i&&!v){const u=e.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(v){if(n?.arcade==null)return void z();const u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},p=n.arcade.arcadeUtils,h=p.getViewInfo(u),V=p.createExecContext(r,h,n.timeZone);if(!f){const w=p.createSyntaxTree(e.valueExpression);f=p.createFunction(w),e.cache.compiledFunc=f}o=p.executeFunction(f,V)}else s&&(o=s[i]);const d=e.normalizationField,m=s!=null&&d!=null?parseFloat(s[d]):void 0;if(o!=null&&(!d||t||!isNaN(m)&&m!==0)){x(m)&&!t&&(o/=m);const u=F(o,c);if(u){const p=u[0],h=u[1];if(p===h)return e.stops[p].opacity;{const V=e.stops[p].opacity;return V+(e.stops[h].opacity-V)*u[2]}}}}function C(a,l,n){const e="visualVariables"in a?a.visualVariables?.find(m=>m.type==="rotation"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void y("RotationVariable");const t=e.axis||"heading",r=t==="heading"&&e.rotationType==="arithmetic"?90:0,s=t==="heading"&&e.rotationType==="arithmetic"?-1:1,o=typeof l=="number"?null:l,i=o?.attributes,c=e.field,{hasExpression:v}=e.cache;let f=e.cache.compiledFunc,d=null;if(!c&&!v)return d;if(v){if(n?.arcade==null)return void z();const m={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},u=n.arcade.arcadeUtils,p=u.getViewInfo(m),h=u.createExecContext(o,p,n.timeZone);if(!f){const V=u.createSyntaxTree(e.valueExpression);f=u.createFunction(V),e.cache.compiledFunc=f}d=u.executeFunction(f,h)}else i&&(d=i[c]);return d=typeof d!="number"||isNaN(d)?null:r+s*d,d}function j(a,l,n){const e=typeof l=="number",t=e?null:l,r=t?.attributes;let s=e?l:null;const{isScaleDriven:o}=a.cache;let i=a.cache.compiledFunc;if(o){const v=n?.scale,f=n?.view;s=v==null||f==="3d"?B(a):v}else if(!e)switch(a.inputValueType){case"expression":{if(n?.arcade==null)return void z();const v={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},f=n.arcade.arcadeUtils,d=f.getViewInfo(v),m=f.createExecContext(t,d,n.timeZone);if(!i){const u=f.createSyntaxTree(a.valueExpression);i=f.createFunction(u),a.cache.compiledFunc=i}s=f.executeFunction(i,m);break}case"field":r&&(s=r[a.field]);break;case"unknown":s=null}if(!x(s))return null;if(e||!a.normalizationField)return s;const c=r?parseFloat(r[a.normalizationField]):null;return x(c)&&c!==0?s/c:null}function B(a){let l=null,n=null;const e=a.stops;return e?(l=e[0].value,n=e[e.length-1].value):(l=a.minDataValue||0,n=a.maxDataValue||0),(l+n)/2}function S(a,l,n){const e="visualVariables"in a?a.visualVariables?.find(r=>r.type==="size"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void y("SizeVariable");const t=T(j(e,l,n),e,l,n,e.cache.ipData);return t==null||isNaN(t)?void 0:t}function b(a,l,n){return a==null?null:_(a)?S(a,l,n):x(a)?a:null}function N(a,l,n){return x(n)&&a>n?n:x(l)&&a<l?l:a}function P(a,l,n,e){const t=b(l.minSize,n,e)||l.minDataValue;return a==null&&t==null?null:(a??0)+(t??0)}function L(a,l,n){const e=a.stops;let t=e?.length&&e[0].size;return t==null&&(t=a.minSize),b(t,l,n)}function G(a,l,n,e){const t=b(l.minSize,n,e);if(a==null)return t;const{minDataValue:r,maxDataValue:s}=l;if(r==null||s==null)return null;const o=(a-r)/(s-r),i=b(l.maxSize,n,e),c=e?.shape;if(a<=r)return t;if(a>=s)return i;if(t==null||i==null)return null;if(l.scaleBy==="area"&&c){const v=c==="circle",f=v?g*(t/2)**2:t*t,d=f+o*((v?g*(i/2)**2:i*i)-f);return v?2*Math.sqrt(d/g):Math.sqrt(d)}return t+o*(i-t)}function H(a,l,n,e){const t=b(l.minSize,n,e);if(a==null||t==null)return t;const r=e?.shape,{minDataValue:s}=l;if(s==null)return null;const o=a/s,i=b(l.maxSize,n,e);let c=null;return c=r==="circle"?2*Math.sqrt(o*(t/2)**2):r==="square"||r==="diamond"||r==="image"?Math.sqrt(o*t**2):o*t,N(c,t,i)}function J(a,l,n,e,t){if(a==null)return null;const[r,s,o]=F(a,t);if(r===s)return b(l.stops?.[r].size,n,e);{const i=b(l.stops?.[r].size,n,e),c=b(l.stops?.[s].size,n,e);return i==null||c==null?null:i+(c-i)*o}}function K(a,l,n,e){const t=(e?.resolution??1)*O[l.valueUnit],r=b(l.minSize,n,e),s=b(l.maxSize,n,e),{valueRepresentation:o}=l;if(a==null)return r;let i=null;return i=o==="area"?2*Math.sqrt(a/g)/t:o==="radius"||o==="distance"?2*a/t:a/t,N(i,r,s)}function T(a,l,n,e,t){switch(l.transformationType){case"additive":return P(a,l,n,e);case"constant":return L(l,n,e);case"clamped-linear":return G(a,l,n,e);case"proportional":return H(a,l,n,e);case"stops":return J(a,l,n,e,t);case"real-world-size":return K(a,l,n,e);case"identity":return a;case"unknown":return null}}function Q(a,l,n){const{isScaleDriven:e}=a.cache;if(!(e&&n==="3d"||l))return null;const t={scale:l,view:n};let r=b(a.minSize,k,t),s=b(a.maxSize,k,t);if(r!=null||s!=null){if(r>s){const o=s;s=r,r=o}return{minSize:r,maxSize:s}}}function W(a,l,n){if(!a.visualVariables)return;const e=[],t=[],r=[],s=[],o=[];for(const i of a.visualVariables)switch(i.type){case"color":t.push(i);break;case"opacity":r.push(i);break;case"rotation":o.push(i);break;case"size":s.push(i)}return t.forEach(i=>{const c=M(i,l,n);e.push({variable:i,value:c})}),r.forEach(i=>{const c=R(i,l,n);e.push({variable:i,value:c})}),o.forEach(i=>{const c=C(i,l,n);e.push({variable:i,value:c})}),s.forEach(i=>{const c=S(i,l,n);e.push({variable:i,value:c})}),e}function F(a,l){if(!l)return;let n=0,e=l.length-1;return l.some((t,r)=>a<t?(e=r,!0):(n=r,!1)),[n,e,(a-l[n])/(l[e]-l[n])]}function X(a,l,n){const e=["proportional","proportional","proportional"];for(const t of a){const r=t.useSymbolValue?"symbol-value":S(t,l,n)??"proportional";switch(t.axis){case"width":e[0]=r;break;case"depth":e[1]=r;break;case"height":e[2]=r;break;case"width-and-depth":e[0]=r,e[1]=r;break;case"all":case void 0:case null:e[0]=r,e[1]=r,e[2]=r;break;default:U(t.axis)}}return e}const ee=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:X,getColor:M,getOpacity:R,getRotationAngle:C,getSize:S,getSizeForValue:T,getSizeFromNumberOrVariable:b,getSizeRangeAtScale:Q,getVisualVariableValues:W,viewScaleRE:Z},Symbol.toStringTag,{value:"Module"}));export{W as D,X as U,A as i,$ as l,C as m,_ as n,Z as p,ee as v};
