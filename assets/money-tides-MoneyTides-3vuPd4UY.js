const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/money-tides-DeclinationAction-BLNYi-7j.js","assets/money-tides-jsxFactory-DEIYsQlk.js","assets/money-tides-config-Dy31BTur.js","assets/index-B1HIWYBB.js","assets/index-CEPnQygF.css","assets/money-tides-index-Bz5uSspo.js","assets/money-tides-runtime-BTGwkf2p.js","assets/runtime-OCMtRbrJ.css","assets/money-tides-app-config-B_lDikIq.js","assets/money-tides-ReactiveMap-DcqEaPSm.js","assets/money-tides-messageBundle-mChLUIbw.js","assets/money-tides-index-BSQMl5Dg.js","assets/DeclinationAction-CtJPH1yU.css","assets/money-tides-FullscreenAction-R6YuC2Ym.js","assets/money-tides-SettingsAction-WnAMiAv4.js","assets/SettingsAction-CESW0KY9.css","assets/money-tides-AttributionAction-BI3Zf69i.js","assets/AttributionAction-DmMpU9qe.css","assets/money-tides-AboutAction-BZWezvrs.js","assets/money-tides-LayersPanel-DeuPpifj.js","assets/money-tides-PanelBase-CPlNoa8m.js","assets/money-tides-AdvisoriesPanel-DIWXVY2l.js","assets/AdvisoriesPanel-DCuVDuTP.css","assets/money-tides-LunarPhasePanel-CeLL0bxK.js","assets/LunarPhasePanel-BnAYxmrE.css","assets/money-tides-TidesDialog-CYjSFMLh.js","assets/TidesDialog-yUcdXs_A.css","assets/money-tides-PlotDialog-BF8NnZLz.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./index-B1HIWYBB.js";import{M as B,as as Jt,Z as Mt,at as m,m as Gt,b as Bt}from"./money-tides-jsxFactory-DEIYsQlk.js";import"./money-tides-config-Dy31BTur.js";import{ds as k,aJ as R,dM as Ct,hq as Et,v as ut,du as O,_ as Ft,y as nt,gc as St,kn as ot,km as it,l7 as Vt,l8 as Wt}from"./money-tides-app-config-B_lDikIq.js";var ht={exports:{}},Pt;function qt(){return Pt||(Pt=1,(function(t,e){(function(){var i=Math.PI,n=Math.sin,o=Math.cos,a=Math.tan,s=Math.asin,d=Math.atan2,h=Math.acos,u=i/180,f=1e3*60*60*24,_=2440588,y=2451545;function b(r){return r.valueOf()/f-.5+_}function E(r){return new Date((r+.5-_)*f)}function T(r){return b(r)-y}var S=u*23.4397;function P(r,l){return d(n(r)*o(S)-a(l)*n(S),o(r))}function D(r,l){return s(n(l)*o(S)+o(l)*n(S)*n(r))}function F(r,l,c){return d(n(r),o(r)*n(l)-a(c)*o(l))}function I(r,l,c){return s(n(l)*n(c)+o(l)*o(c)*o(r))}function x(r,l){return u*(280.16+360.9856235*r)-l}function C(r){return r<0&&(r=0),2967e-7/Math.tan(r+.00312536/(r+.08901179))}function V(r){return u*(357.5291+.98560028*r)}function Y(r){var l=u*(1.9148*n(r)+.02*n(2*r)+3e-4*n(3*r)),c=u*102.9372;return r+l+c+i}function gt(r){var l=V(r),c=Y(l);return{dec:D(c,0),ra:P(c,0)}}var z={};z.getPosition=function(r,l,c){var v=u*-c,p=u*l,w=T(r),g=gt(w),M=x(w,v)-g.ra;return{azimuth:F(M,p,g.dec),altitude:I(M,p,g.dec)}};var dt=z.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];z.addTime=function(r,l,c){dt.push([r,l,c])};var vt=9e-4;function Rt(r,l){return Math.round(r-vt-l/(2*i))}function _t(r,l,c){return vt+(r+l)/(2*i)+c}function bt(r,l,c){return y+r+.0053*n(l)-.0069*n(2*c)}function It(r,l,c){return h((n(r)-n(l)*n(c))/(o(l)*o(c)))}function jt(r){return-2.076*Math.sqrt(r)/60}function Nt(r,l,c,v,p,w,g){var M=It(r,c,v),A=_t(M,l,p);return bt(A,w,g)}z.getTimes=function(r,l,c,v){v=v||0;var p=u*-c,w=u*l,g=jt(v),M=T(r),A=Rt(M,p),$=_t(0,p,A),j=V($),W=Y(j),U=D(W,0),N=bt($,j,W),q,Q,J,H,Z,K,L={solarNoon:E(N),nadir:E(N-.5)};for(q=0,Q=dt.length;q<Q;q+=1)J=dt[q],H=(J[0]+g)*u,Z=Nt(H,p,w,U,A,j,W),K=N-(Z-N),L[J[1]]=E(K),L[J[2]]=E(Z);return L};function wt(r){var l=u*(218.316+13.176396*r),c=u*(134.963+13.064993*r),v=u*(93.272+13.22935*r),p=l+u*6.289*n(c),w=u*5.128*n(v),g=385001-20905*o(c);return{ra:P(p,w),dec:D(p,w),dist:g}}z.getMoonPosition=function(r,l,c){var v=u*-c,p=u*l,w=T(r),g=wt(w),M=x(w,v)-g.ra,A=I(M,p,g.dec),$=d(n(M),a(p)*o(g.dec)-n(g.dec)*o(M));return A=A+C(A),{azimuth:F(M,p,g.dec),altitude:A,distance:g.dist,parallacticAngle:$}},z.getMoonIllumination=function(r){var l=T(r||new Date),c=gt(l),v=wt(l),p=149598e3,w=h(n(c.dec)*n(v.dec)+o(c.dec)*o(v.dec)*o(c.ra-v.ra)),g=d(p*n(w),v.dist-p*o(w)),M=d(o(c.dec)*n(c.ra-v.ra),n(c.dec)*o(v.dec)-o(c.dec)*n(v.dec)*o(c.ra-v.ra));return{fraction:(1+o(g))/2,phase:.5+.5*g*(M<0?-1:1)/Math.PI,angle:M}};function tt(r,l){return new Date(r.valueOf()+l*f/24)}z.getMoonTimes=function(r,l,c,v){var p=new Date(r);v?p.setUTCHours(0,0,0,0):p.setHours(0,0,0,0);for(var w=.133*u,g=z.getMoonPosition(p,l,c).altitude-w,M,A,$,j,W,U,N,q,Q,J,H,Z,K,L=1;L<=24&&(M=z.getMoonPosition(tt(p,L),l,c).altitude-w,A=z.getMoonPosition(tt(p,L+1),l,c).altitude-w,W=(g+A)/2-M,U=(A-g)/2,N=-U/(2*W),q=(W*N+U)*N+M,Q=U*U-4*W*M,J=0,Q>=0&&(K=Math.sqrt(Q)/(Math.abs(W)*2),H=N-K,Z=N+K,Math.abs(H)<=1&&J++,Math.abs(Z)<=1&&J++,H<-1&&(H=Z)),J===1?g<0?$=L+H:j=L+H:J===2&&($=L+(q<0?Z:H),j=L+(q<0?H:Z)),!($&&j));L+=2)g=A;var et={};return $&&(et.rise=tt(p,$)),j&&(et.set=tt(p,j)),!$&&!j&&(et[q>0?"alwaysUp":"alwaysDown"]=!0),et},t.exports=z})()})(ht)),ht.exports}var X=qt();const Tt=(t,e)=>{const i=new URL(t);return Object.entries(e).forEach(([n,o])=>{i.searchParams.append(n,String(o))}),i.toString()},Dt=t=>{const e=Number(pt(t).toFixed(0));return e===0?"South":e===90?"West":e===-90?"East":e===180||e===-180?"North":e>0&&e<90?`S ${e}° W`:e>90?`N ${e-90}° W`:e<0&&e>-90?`S ${Math.abs(e)}° E`:e<-90?`N ${Math.abs(e)-90}° E`:"invalid azimuth"},ie=async(t,e,i)=>{try{const n=Tt("https://www.ngdc.noaa.gov/geomag-web/calculators/calculateDeclination",{key:"zNEw7",lat1:e,lon1:i,model:"WMM",startYear:t.get("year"),startMonth:t.get("month"),startDay:t.get("day"),resultFormat:"json"}),a=(await(await fetch(n)).json()).result[0].declination,s=Math.abs(a),d=a>0?"E":"W";return{bearing:a===0?"0°":`${Math.floor(s)}° ${Math.floor((s-Math.floor(s))*60)}' ${d}`,declination:a}}catch(n){return console.log(n),{bearing:"invalid",declination:-999}}},Zt=t=>t<=.05?"New Moon":t>.05&&t<.2?"Waxing Crescent":t>=.2&&t<=.3?"First Quarter":t>.3&&t<.45?"Waxing Gibbous":t>=.45&&t<=.55?"Full Moon":t>.55&&t<.7?"Waning Gibbous":t>=.7&&t<=.8?"Last Quarter":t>.8?"Waning Crescent":"Invalid Phase",pt=t=>t*180/Math.PI,st=(t,e,i)=>{const n=t.toJSDate(),{rise:o,set:a}=X.getMoonTimes(n,e,i),{distance:s}=X.getMoonPosition(n,e,i),{fraction:d,phase:h}=X.getMoonIllumination(n),{nadir:u,solarNoon:f,sunrise:_,sunset:y}=X.getTimes(n,e,i);return{moon:{distance:s,distanceFromAverage:-(s-384400),illumination:d,illuminationPercent:`${(d*100).toFixed(0)}%`,moonrise:o?B.fromJSDate(o):void 0,moonset:a?B.fromJSDate(a):void 0,phase:h,phaseName:Zt(h)},sun:{nadir:B.fromJSDate(u),solarNoon:B.fromJSDate(f),sunrise:B.fromJSDate(_),sunset:B.fromJSDate(y)}}},at=(t,e,i)=>{const n=t.toJSDate(),{moon:{moonrise:o,moonset:a},sun:{sunrise:s,sunset:d}}=st(t,e,i),{altitude:h,azimuth:u}=X.getMoonPosition(n,e,i),{altitude:f,azimuth:_}=X.getPosition(n,e,i),y=t.toMillis(),b=o&&y===o.toMillis()||a&&y===a.toMillis(),E=y===s.toMillis()||y===d.toMillis(),T=pt(h),S=pt(f);return{moonPosition:{aboveHorizon:b?!0:h>0,altitude:T,altitudeDegrees:b?"0°":`${T.toFixed(0)}°`,azimuth:u,azimuthBearing:Dt(u),type:"moon"},sunPosition:{aboveHorizon:E?!0:f>0,altitude:S,altitudeDegrees:E?"0°":`${S.toFixed(0)}°`,azimuth:_,azimuthBearing:Dt(_),type:"sun"}}},kt=[new R([215,25,28]),new R([253,174,97]),new R([255,255,191]),new R([166,217,106]),new R([26,150,65])],At=["not-money","potentially-money","kinda-money","mostly-money","money"],ae=(t,e)=>{const i=getComputedStyle(document.body).getPropertyValue(t);if(!e)return i;const{opacity:n,type:o}=e,a=new R(i);return a.a=n||1,o==="hex"?a.toHex({digits:8}):a.toCss(!0)},se=(t,e)=>kt[At.indexOf(t)].toHex(),xt=t=>{const e=kt[At.indexOf(t)];return k.colorType==="light"&&e.toHex({digits:6})==="#ffffbf"?{primary:new R([64,64,64]),secondary:e}:{primary:e,secondary:k.colorType==="dark"?new R([32,32,32]):new R([255,255,255])}},Yt="M10.5 7.095h-.008a6.76 6.76 0 0 0-.848.108c-.022-.471-.41-1.05-.887-1.05a.892.892 0 0 0-.892.892.883.883 0 0 0 .139.467 5.507 5.507 0 0 0-1.13.678.153.153 0 0 0-.064-.136c-.015-.01-1.377-.948-1.336-2.065a3.838 3.838 0 0 0 2.502-.523c.361-.286.867-.675.912-1.158a.155.155 0 0 0-.21-.159 8.942 8.942 0 0 1-2.167.409 4.498 4.498 0 0 1 1.95-2.225.173.173 0 0 0 .097-.165.155.155 0 0 0-.137-.134c-.14-.016-3.642.64-4.108 2.533-.494 2.005.206 2.911.248 2.963l1.59 1.367a4.28 4.28 0 0 0-.482.737c-.422-.206-1.94-.811-2.118-1.435a12.964 12.964 0 0 1-.92-2.796.152.152 0 0 0-.162-.12.155.155 0 0 0-.144.14 8.124 8.124 0 0 0 .197 3.46c.054.07 1.829 1.601 3.075 1.668.032.14.074.496.128.662-.493-.118-1.837-.433-2.373-.487a.15.15 0 0 0-.153.08 12.457 12.457 0 0 0-1.17 2.863 5.375 5.375 0 0 0 .002 1.201.155.155 0 0 0 .13.128l.023.001a.155.155 0 0 0 .139-.087l1.482-3.042a19.099 19.099 0 0 0 2.418.422h.005a4.8 4.8 0 0 0 .23.337 4.961 4.961 0 0 0-1.987.747 2.575 2.575 0 0 0-.544 1.912c0 .876 1.259 1.618 1.436 1.655a.16.16 0 0 0 .031.003.155.155 0 0 0 .107-.267 3.57 3.57 0 0 1-.74-1.523 3.68 3.68 0 0 1 .221-.943l2.13-.775a.151.151 0 0 0 .07-.052 4.608 4.608 0 0 0 .59.41L6.33 15.064a.155.155 0 0 0-.04.178c.033.076 1.222 2.465 2.265 2.605a3.554 3.554 0 0 0 .625.075 3.156 3.156 0 0 0 .474-.028.155.155 0 0 0 .042-.292 6.336 6.336 0 0 1-1.895-1.837l-.154-.36 1.09-1.171a6.87 6.87 0 0 0 1.763.337 6.87 6.87 0 0 0 1.763-.337l1.09 1.171-.154.36a6.336 6.336 0 0 1-1.895 1.837.155.155 0 0 0 .042.292 3.156 3.156 0 0 0 .474.028 3.554 3.554 0 0 0 .625-.075c1.043-.14 2.232-2.529 2.265-2.605a.155.155 0 0 0-.04-.178l-1.443-1.268a4.608 4.608 0 0 0 .592-.41.151.151 0 0 0 .069.052l2.13.775a3.68 3.68 0 0 1 .221.943 3.57 3.57 0 0 1-.74 1.523.155.155 0 0 0 .107.267.16.16 0 0 0 .03-.003c.178-.037 1.437-.779 1.437-1.655a2.575 2.575 0 0 0-.544-1.912 4.961 4.961 0 0 0-1.987-.747 4.8 4.8 0 0 0 .23-.337h.005a19.099 19.099 0 0 0 2.418-.422l1.482 3.042a.155.155 0 0 0 .14.087l.022-.001a.155.155 0 0 0 .13-.128 5.375 5.375 0 0 0 .002-1.2 12.457 12.457 0 0 0-1.17-2.863.15.15 0 0 0-.153-.081c-.536.054-1.88.369-2.373.487.054-.166.096-.521.128-.662 1.246-.067 3.02-1.598 3.075-1.668a8.124 8.124 0 0 0 .197-3.46.155.155 0 0 0-.144-.14.152.152 0 0 0-.162.12 12.964 12.964 0 0 1-.92 2.796c-.178.624-1.696 1.23-2.118 1.435a4.28 4.28 0 0 0-.483-.737l1.59-1.367c.043-.052.743-.958.25-2.963-.467-1.893-3.97-2.549-4.11-2.533a.155.155 0 0 0-.136.134.173.173 0 0 0 .098.165 4.498 4.498 0 0 1 1.95 2.225 8.942 8.942 0 0 1-2.168-.409.155.155 0 0 0-.21.16c.045.482.55.871.912 1.157a3.838 3.838 0 0 0 2.502.523c.04 1.117-1.321 2.056-1.336 2.065a.153.153 0 0 0-.065.136 5.507 5.507 0 0 0-1.129-.678.883.883 0 0 0 .139-.467.892.892 0 0 0-.892-.891c-.477 0-.865.578-.887 1.05a6.76 6.76 0 0 0-.848-.109z",Ot=new Ct({size:12,outline:{width:0},path:Yt}),lt=new Ct({style:"circle",size:18,outline:{width:1}}),Lt=new Et({font:{size:12},haloSize:1.75,horizontalAlignment:"left",verticalAlignment:"middle",xoffset:12}),zt=new Et({font:{size:12},haloSize:1.75,horizontalAlignment:"left",verticalAlignment:"top",xoffset:12,yoffset:-9}),Ut=t=>{const{money:e,name:i,tides:n}=t,{primary:o,secondary:a}=xt(e),s=Object.assign(Ot.clone(),{color:o}),d=Object.assign(lt.clone(),{color:a,outline:{color:o,width:lt.outline.width}}),h=Object.assign(Lt.clone(),{color:o,haloColor:a,text:i}),u=Object.assign(zt.clone(),{color:o,haloColor:a,text:$t(n)});return{crabSymbol:s,markerSymbol:d,stationSymbol:h,tidesSymbol:u}},$t=t=>t.filter(e=>e.isPrediction&&e.isDate).map(e=>{const{heightLabel:i,time:n,type:o}=e;return`${n} ${o} ${i}`}).join(`
`),Qt=t=>{const{error:e,money:i,name:n,tides:o}=t;let{primary:a,secondary:s}=xt(i);e&&(a=new R("black"),s=new R("white"));const d=Object.assign(Ot.clone(),{color:a}),h=Object.assign(lt.clone(),{color:s,outline:{color:a,width:lt.outline.width}}),u=Object.assign(Lt.clone(),{color:a,haloColor:s,text:n}),f=Object.assign(zt.clone(),{color:e?null:a,haloColor:e?null:s,text:$t(o)});return{crabSymbol:d,markerSymbol:h,stationSymbol:u,tidesSymbol:f}};var Kt=Object.defineProperty,Xt=Object.getOwnPropertyDescriptor,Ht=(t,e,i,n)=>{for(var o=n>1?void 0:n?Xt(e,i):e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(o=(n?s(e,i,o):s(o))||o);return n&&o&&Kt(e,i,o),o};const rt=(t,e)=>{const i=t.filter(b=>b.isPrediction),n=-999;let o;if(i.forEach(b=>{b.date.toMillis()<e.toMillis()&&(o=b)}),!o)return n;const a=i[i.indexOf(o)+1];if(!a)return n;const{date:s,height:d}=o,{date:h,height:u}=a,f=s.toMillis(),_=h.toMillis(),y=e.toMillis();return y<f&&y<_||y>f&&y>_?n:Number((d+(u-d)*(y-f)/(_-f)).toFixed(2))},mt="money-tides",ft={header:`${mt}_header`,headerDate:`${mt}_header--date`,view:`${mt}_view`};let yt=0,ct=class extends Jt{constructor(t){super(t),this._container=document.createElement("calcite-shell"),this.alerts=new ut,this.panelHideMethods=[],this.stations=new ut,this.visiblePanel=null,this.zoomToDropdownItems=new ut,this.container=this._container,document.body.appendChild(this.container);const{zoomToDropdownItems:e}=this;this.addHandles([Mt(()=>k.colorType,()=>{this.stations.forEach(this.updateGraphics.bind(this))}),e.on("after-add",()=>{e.sort((i,n)=>i.name<n.name?-1:i.name>n.name?1:0)})])}get container(){return this._container}set container(t){this._container=t}addZoomToItem(t,e){this.zoomToDropdownItems.add({name:e,element:m("calcite-dropdown-item",{"icon-start":"pin-tear",key:yt++,onclick:()=>{const i=this.stations.find(n=>n.id===t);i&&(O.goTo(i.graphics.markerGraphic),O.scale=6e4,this.tidesDialog.open(i))}},e)})}createGraphics(t){const{graphics:e}=O,{id:i,latitude:n,longitude:o,money:a,name:s,tides:d}=t,{crabSymbol:h,markerSymbol:u,stationSymbol:f,tidesSymbol:_}=Ut({money:a,name:s,tides:d}),y={id:i},b=new Ft({latitude:n,longitude:o}),E=new nt({attributes:y,geometry:b,symbol:h}),T=new nt({attributes:y,geometry:b,symbol:u}),S=new nt({attributes:y,geometry:b,symbol:f}),P=new nt({attributes:y,geometry:b,symbol:_,visible:O.scale<24e4});return this.addHandles(Mt(()=>O.scale,()=>{P.visible=O.scale<24e4})),e.addMany([T,E,S,P]),{crabGraphic:E,markerGraphic:T,stationGraphic:S,tidesGraphic:P}}async getTides(t){const{date:e,id:i,latitude:n,longitude:o}=t,a=e.minus({day:1}),s=e.plus({day:1}),h=(await(await fetch(Tt("https://api.tidesandcurrents.noaa.gov/api/prod/datagetter",{product:"predictions",format:"json",interval:"hilo",time_zone:"lst_ldt",units:"english",datum:"mllw",station:i,begin_date:St(a),end_date:St(s)}))).json()).predictions.map(P=>{const{t:D,v:F,type:I}=P,x=B.fromSQL(D).setZone("America/Los_Angeles"),C=Number(Number(F).toFixed(2));return{date:x,height:C,heightLabel:`${C} ft`,isDate:e.hasSame(x,"day"),isLunar:!1,isPrediction:!0,isSolar:!1,money:"not-money",...at(x,n,o),time:ot(x),type:I==="H"?"high tide":"low tide"}}),u=this.money(h),{moon:f,sun:_}=st(a,n,o),{moon:y,sun:b}=st(e,n,o),{moon:E,sun:T}=st(s,n,o),S=[{date:_.nadir,event:"solar nadir",type:"solar"},{date:_.solarNoon,event:"solar noon",type:"solar"},{date:_.sunrise,event:"sunrise",type:"solar"},{date:_.sunset,event:"sunset",type:"solar"},{date:b.nadir,event:"solar nadir",type:"solar"},{date:b.solarNoon,event:"solar noon",type:"solar"},{date:b.sunrise,event:"sunrise",type:"solar"},{date:b.sunset,event:"sunset",type:"solar"},{date:T.nadir,event:"solar nadir",type:"solar"},{date:T.solarNoon,event:"solar noon",type:"solar"},{date:T.sunrise,event:"sunrise",type:"solar"},{date:T.sunset,event:"sunset",type:"solar"}];return f.moonrise&&S.push({date:f.moonrise,event:"moonrise",type:"lunar"}),f.moonset&&S.push({date:f.moonset,event:"moonset",type:"lunar"}),y.moonrise&&S.push({date:y.moonrise,event:"moonrise",type:"lunar"}),y.moonset&&S.push({date:y.moonset,event:"moonset",type:"lunar"}),E.moonrise&&S.push({date:E.moonrise,event:"moonrise",type:"lunar"}),E.moonset&&S.push({date:E.moonset,event:"moonset",type:"lunar"}),S.forEach(P=>{const{date:D,event:F,type:I}=P,x=rt(h,D);h.push({date:D,height:x,heightLabel:`${x} ft`,isDate:e.hasSame(D,"day"),isLunar:I==="lunar",isPrediction:!1,isSolar:I==="solar",money:"not-money",...at(D,n,o),time:ot(D),type:F})}),h.sort((P,D)=>P.date.toMillis()-D.date.toMillis()),h.filter(P=>P.isLunar).forEach((P,D,F)=>{const{date:I,type:x}=P;let C,V;if(x==="moonrise"){const Y=F[D+1];Y&&(C=B.fromMillis(Math.floor((I.toMillis()+Y.date.toMillis())/2)),V=rt(h,C),h.push({date:C,height:V,heightLabel:`${V} ft`,isDate:e.hasSame(C,"day"),isLunar:!0,isPrediction:!1,isSolar:!1,money:"not-money",...at(C,n,o),time:ot(C),type:"lunar noon"}))}if(x==="moonset"){const Y=F[D+1];Y&&(C=B.fromMillis(Math.floor((I.toMillis()+Y.date.toMillis())/2)),V=rt(h,C),h.push({date:C,height:V,heightLabel:`${V} ft`,isDate:e.hasSame(C,"day"),isLunar:!0,isPrediction:!1,isSolar:!1,money:"not-money",...at(C,n,o),time:ot(C),type:"lunar nadir"}))}}),h.sort((P,D)=>P.date.toMillis()-D.date.toMillis()),{money:u,moon:y,sun:b,tides:h}}getTimeRange(t){if(!t)return 0;const e=t.toMillis();return e>=it(t,{hour:11}).toMillis()&&e<=it(t,{hour:13}).toMillis()?2:e>=it(t,{hour:10}).toMillis()&&e<=it(t,{hour:14}).toMillis()?1:0}async loadStation(t){try{const{id:e,latitude:i,longitude:n,name:o,weather:a}=t,s=k.date,{money:d,moon:h,sun:u,tides:f}=await this.getTides({date:s,id:e,latitude:i,longitude:n});this.stations.add({date:s,error:!1,errorCount:0,graphics:this.createGraphics({id:e,latitude:i,longitude:n,money:d,name:o,tides:f}),id:e,latitude:i,longitude:n,name:o,money:d,moon:h,sun:u,tides:f,weather:a}),this.addZoomToItem(e,o),t.loaded=!0}catch(e){if(console.log("load error",e),t.errorCount!==10){t.errorCount++,setTimeout(()=>{this.loadStation(t)},t.errorCount*50);return}const i=`station-error-alert-${t.id}`,n=this.container.querySelector(`#${i}`);if(n){n.open=!0;return}this.alerts.add(m("calcite-alert",{"auto-close":"","auto-close-duration":"fast",icon:"exclamation-mark-triangle",id:i,key:yt++,kind:"danger",open:!0,scale:k.scale,slot:"alerts"},m("div",{slot:"title"},"Error"),m("div",{slot:"message"},"Failed to load station data for ",t.name)))}}money(t){const e=t.filter(s=>s.isDate).toSorted((s,d)=>d.height-s.height),i=e[0],n=e[1].type==="high tide"?e[1]:null,o=this.getTimeRange(i.date),a=this.getTimeRange(n?.date);return o===2?(t[t.indexOf(i)].money="money","money"):o===1?(t[t.indexOf(i)].money="mostly-money","mostly-money"):a===2&&n?(t[t.indexOf(n)].money="kinda-money","kinda-money"):a===1&&n?(t[t.indexOf(n)].money="potentially-money","potentially-money"):"not-money"}updateGraphics(t){const{error:e,graphics:{crabGraphic:i,markerGraphic:n,stationGraphic:o,tidesGraphic:a},money:s,name:d,tides:h}=t,{crabSymbol:u,markerSymbol:f,stationSymbol:_,tidesSymbol:y}=Qt({error:e,money:s,name:d,tides:h});i.symbol=u,n.symbol=f,o.symbol=_,a.symbol=y}async updateStation(t){const{tidesDialog:e}=this,i=k.date,{id:n,latitude:o,longitude:a}=t;try{const{money:s,moon:d,sun:h,tides:u}=await this.getTides({date:i,id:n,latitude:o,longitude:a});Object.assign(t,{date:i,money:s,moon:d,sun:h,tides:u}),t.error=!1,t.errorCount=0,this.updateGraphics(t),e.container.open&&e.station.id===n&&e.open(t);const f=this.container.querySelector(`#station-error-alert-${n}`);f&&(f.open=!1)}catch(s){if(console.log("update error",s),t.error=!0,this.updateGraphics(t),t.errorCount!==10){t.errorCount++,setTimeout(()=>{this.updateStation(t)},t.errorCount*50);return}const d=`station-error-alert-${t.id}`,h=this.container.querySelector(`#${d}`);if(h){h.open=!0;return}t.errorCount=0,e.container.open&&e.station.id===n&&e.close(),this.alerts.add(m("calcite-alert",{"auto-close":"","auto-close-duration":"fast",icon:"exclamation-mark-triangle",id:d,key:yt++,kind:"danger",open:!0,scale:k.scale,slot:"alerts"},m("div",{slot:"title"},"Error"),m("div",{slot:"message"},"Failed to load station data for ",t.name)))}}dateChangeEvent(t){k.date=Vt(B.fromISO(t.target.value).setZone("America/Los_Angeles")),this.stations.forEach(this.updateStation.bind(this))}dateButtonClickEvent(t){const e=t.target.iconStart,i=k.date=e==="chevron-right"?k.date.plus({days:1}):k.date.minus({days:1});this.datePicker.value=i.toISODate(),this.datePicker.dispatchEvent(new Event("calciteInputDatePickerChange"))}actionClickEvent(t){if(!t){for(const e of this.panelHideMethods)e();this.visiblePanel=null;return}if(t&&this.visiblePanel===t){t.hide(),this.visiblePanel=null;return}t&&this.visiblePanel!==t&&this.visiblePanel?.hide(),this.tidesDialog.close(),t.show(),this.visiblePanel=t}async viewClickEvent(t){t.stopPropagation();const{tidesDialog:e}=this,i=(await O.hitTest(t,{include:[O.graphics]})).results[0];if(!i||i.type!=="graphic"){e.close();return}const n=this.stations.find(o=>o.id===i.graphic.attributes.id);!n||n&&n.error||(this.actionClickEvent(null),e.open(n))}render(){const t=k.scale,{alerts:e,visiblePanel:i,zoomToDropdownItems:n}=this,o=i===this.lunarPhasePanel?"--calcite-shell-panel-min-width: 260px;":"";return m("calcite-shell",{"content-behind":""},m("div",{class:ft.header,slot:"header"},m("div",{class:ft.headerDate},m("calcite-button",{"icon-start":"chevron-left",scale:t,onclick:this.dateButtonClickEvent.bind(this)}),m("calcite-input-date-picker",{"overlay-positioning":"fixed",scale:t,afterCreate:this.datePickerAfterCreate.bind(this)}),m("calcite-button",{"icon-start":"chevron-right",scale:t,onclick:this.dateButtonClickEvent.bind(this)}))),m("calcite-shell-panel",{"display-mode":"float-content",position:k.layout,slot:`panel-${k.layout}`,style:o},m("calcite-action-bar",{scale:t,slot:"action-bar",afterCreate:this.actionBarAfterCreate.bind(this)},m("calcite-action-group",null,m("calcite-dropdown",{placement:"left","offset-distance":"10","offset-skidding":"10",scale:t},m("calcite-action",{icon:"zoom-to-object",scale:t,slot:"trigger",text:"Zoom To",onclick:this.actionClickEvent.bind(this,null)}),m("calcite-dropdown-group",{"group-title":"Zoom to","selection-mode":"none"},n.map(a=>a.element).toArray())),m("calcite-action",{active:this.layersPanel===i,icon:"layers",scale:t,text:"Layers",onclick:this.actionClickEvent.bind(this,this.layersPanel)}),m("calcite-action",{active:this.advisoriesPanel===i,icon:"exclamation-mark-triangle",scale:t,text:"Advisories",onclick:this.actionClickEvent.bind(this,this.advisoriesPanel)}),m("calcite-action",{active:this.lunarPhasePanel===i,icon:"moon",scale:t,text:"Lunar Phase",onclick:this.actionClickEvent.bind(this,this.lunarPhasePanel)}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async a=>{new(await G(async()=>{const{default:s}=await import("./money-tides-DeclinationAction-BLNYi-7j.js");return{default:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))).default({container:a})}})),m("calcite-action-group",{slot:"actions-end"},m("calcite-action",{afterCreate:async a=>{new(await G(async()=>{const{default:s}=await import("./money-tides-FullscreenAction-R6YuC2Ym.js");return{default:s}},__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11]))).default({container:a})}}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async a=>{new(await G(async()=>{const{default:s}=await import("./money-tides-SettingsAction-WnAMiAv4.js");return{default:s}},__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,15]))).default({container:a})}}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async a=>{new(await G(async()=>{const{default:s}=await import("./money-tides-AttributionAction-BI3Zf69i.js");return{default:s}},__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,17]))).default({container:a})}}),m("calcite-action",{afterCreate:async a=>{new(await G(async()=>{const{default:s}=await import("./money-tides-AboutAction-BZWezvrs.js");return{default:s}},__vite__mapDeps([18,3,4,1,2,5,6,7,8,9,10,11]))).default({container:a})}}))),m("calcite-panel",{afterCreate:async a=>{const s=this.layersPanel=new(await G(async()=>{const{default:d}=await import("./money-tides-LayersPanel-DeuPpifj.js");return{default:d}},__vite__mapDeps([19,3,4,1,2,5,6,7,20,8,9,10,11]))).default({container:a});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}}),m("calcite-panel",{afterCreate:async a=>{const s=this.advisoriesPanel=new(await G(async()=>{const{default:d}=await import("./money-tides-AdvisoriesPanel-DIWXVY2l.js");return{default:d}},__vite__mapDeps([21,3,4,1,2,5,6,7,20,8,9,10,11,22]))).default({container:a});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}}),m("calcite-panel",{afterCreate:async a=>{const s=this.lunarPhasePanel=new(await G(async()=>{const{default:d}=await import("./money-tides-LunarPhasePanel-CeLL0bxK.js");return{default:d}},__vite__mapDeps([23,1,2,3,4,5,6,7,20,8,9,10,11,24]))).default({container:a});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}})),e.toArray(),m("calcite-dialog",{slot:"dialogs",afterCreate:this.tidesDialogAfterCreate.bind(this)}),m("div",{class:ft.view,afterCreate:this.viewAfterCreate.bind(this)}))}actionBarAfterCreate(t){const e=()=>{const i=t.getBoundingClientRect().width;O.padding={...O.padding,right:i}};e(),new ResizeObserver(()=>{e()}).observe(t)}datePickerAfterCreate(t){const e=k.date.toISODate();t.value=e,t.addEventListener("calciteInputDatePickerChange",this.dateChangeEvent.bind(this)),this.datePicker=t}async tidesDialogAfterCreate(t){this.tidesDialog=new(await G(async()=>{const{default:i}=await import("./money-tides-TidesDialog-CYjSFMLh.js");return{default:i}},__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,26]))).default({container:t});const e=new(await G(async()=>{const{default:i}=await import("./money-tides-PlotDialog-BF8NnZLz.js");return{default:i}},__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11]))).default;this.addHandles(this.tidesDialog.on("plot-tides",e.open.bind(e)))}async viewAfterCreate(t){O.container=t,O.ui.remove(["attribution","zoom"]);for(const e of Wt)Object.assign(e,{errorCount:0,loaded:!1}),this.loadStation(e);this.addHandles(O.on("click",this.viewClickEvent.bind(this))),this.emit("loaded")}};Ht([Gt()],ct.prototype,"visiblePanel",2);ct=Ht([Bt("MoneyTides")],ct);const re=Object.freeze(Object.defineProperty({__proto__:null,get default(){return ct},tideHeight:rt},Symbol.toStringTag,{value:"Module"}));export{re as M,ie as a,Tt as c,ae as g,se as m,st as s,rt as t};
