import{j$ as $,kf as x,i0 as _,b as d,d8 as b,bK as F,X as m,v as r,x as s,y as q,cu as I,af as S,C as y,P as c,cr as P,kj as h,fd as j,s as T,ce as g,ct as R,a3 as J,du as N,c5 as E,bD as f,cC as z,bA as C}from"./index-V7-iOmRK.js";import{l as D}from"./c-MultiOriginJSONSupport-BIX9Pw8I.js";import{s as k,o as L}from"./c-GraphicOrigin-D4J7BZqr.js";import{p as Q,i as U,s as A,a as V,c as u}from"./c-parquetUtils-Ca8bv1cL.js";import{g as G}from"./c-FeatureSet-C1_P_L0R.js";import{p as W}from"./c-BlendLayer-0oeXJ-D3.js";import{s as H}from"./c-CustomParametersMixin-B_nmBhfW.js";import{a as M}from"./c-DisplayFilteredLayer-Co7Kqq8y.js";import{c as B}from"./c-FeatureEffectLayer-Cmertuds.js";import{f as K}from"./c-FeatureReductionLayer-Bd_ay4K4.js";import{b as X,p as Y,d as Z,l as ee}from"./c-OperationalLayer-DBgL_H7Y.js";import{p as te}from"./c-OrderedLayer--kNWV2R2.js";import{t as re}from"./c-ScaleRangeLayer-MYQIkVlG.js";import{l as ie}from"./c-TemporalLayer-BngeN_V8.js";import{a as se}from"./c-FeatureTemplate-CYVWtRpe.js";import{s as oe}from"./c-fieldProperties-CqkZ6hF_.js";import{l as ae,A as ne}from"./c-labelingInfo-DNPlm2HB.js";import{m as le}from"./c-typeUtils-DQ0b5QCt.js";import{d as pe}from"./c-popupUtils-r_fAWio0.js";import"./c-locationUtils-CycA0Spz.js";import"./c-parquet-BgT2Klrp.js";import"./c-QueueProcessor-i_HdH2g-.js";import"./c-layerContainerType-CSXZNpHb.js";import"./c-jsonUtils-BiiNRE_z.js";import"./c-parser-DpJmgZtM.js";import"./c-scaleUtils-BJmtNLES.js";import"./c-displayFilterUtils-By2oMxy6.js";import"./c-FeatureEffect-FHk3isrL.js";import"./c-FeatureFilter-CXeAyATl.js";import"./c-FeatureReductionSelection-BoA1swBU.js";import"./c-jsonUtils-ra5X4vx2.js";import"./c-SimpleRenderer-Bgq6dRlV.js";import"./c-commonProperties-DStUyNLT.js";import"./c-colorRamps-K0ygLh8y.js";import"./c-ColorStop-E4kB3v4U.js";import"./c-visualVariableUtils-BF8nmPpS.js";import"./c-lengthUtils-BWeV-PXx.js";import"./c-jsonUtils-BRz-Z2iJ.js";import"./c-defaults3D-CRqvLB5H.js";import"./c-defaults-bLIl2uCI.js";import"./c-defaultsJSON-GKolV7NZ.js";import"./c-ElevationInfo-B-sqn7f7.js";import"./c-OrderByInfo-nsDVemqa.js";import"./c-TimeInfo-DZ2ww4Mw.js";import"./c-FieldsIndex-ZCdj3BhI.js";import"./c-UnknownTimeZone-DvWMmddf.js";import"./c-UniqueValueRenderer-C6WtN3sz.js";import"./c-diffUtils-5ffNZrBe.js";import"./c-RendererLegendOptions-vImNGT8p.js";import"./c-styleUtils-BW1HWYV-.js";import"./c-NormalizationBinParametersMixin-DUzO0m9A.js";import"./c-labelUtils-DIYWssXO.js";import"./c-ClassBreaksRenderer-DauGcLhC.js";import"./c-LRUCache-DOaVDtw2.js";import"./c-MemCache-DEmDtFHr.js";import"./c-DictionaryScriptEvaluator-BroMqYBJ.js";import"./c-ArcadeExpression-BIOUWGGW.js";import"./c-TimeOnly-Bxs8tNzP.js";import"./c-enum-DPjZ9jVC.js";import"./c-utils-CHZjXsGA.js";import"./c-defaultCIMValues-XI-Li77m.js";import"./c-heatmapUtils-BAcLpUSZ.js";import"./c-vec42-Bu75dI_C.js";import"./c-vec4f64-DPb6J-GU.js";const ue=Symbol("isParquetGraphicOrigin");var v;class ye extends k{get[(v=ue,$)](){return this.layer}get[x](){return this.layer}get[L](){return this.layer}constructor(t){super(),this[v]=!0,this.type="parquet",this.layer=t}get id(){return this.layer.id}}let p=class extends _{constructor(e){super(e),this.type="parquet"}load(e){const t=e!=null?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){this._connection?.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{d.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t?.signal})}async queryFeatures(e,t={}){const o=await this.queryFeaturesJSON(e,{signal:t?.signal});return G.fromJSON(o)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t?.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t?.signal})}async queryExtent(e,t){if(this.layer.encoding==null)return d.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const o=await this._proxy.queryExtent(e.toJSON(),{signal:t?.signal});return{count:o.count,extent:b.fromJSON(o.extent)}}async _initialize(e){this._connection=await F("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),m(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:t,capabilities:o}=await this._proxy.load({urls:this.layer.urls.items,fields:this.layer.fields?.map(a=>a.toJSON()),geometryType:this.layer.geometryType?Q(this.layer.geometryType):null,spatialReference:this.layer.spatialReference?.toJSON(),encoding:this.layer.encoding?.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});m(e),this.sourceJSON=t,this.capabilities=o}};r([s()],p.prototype,"type",void 0),r([s({constructOnly:!0})],p.prototype,"layer",void 0),r([s()],p.prototype,"sourceJSON",void 0),r([s()],p.prototype,"capabilities",void 0),p=r([q("esri.layers.graphics.sources.ParquetSource")],p);const w=oe(),O="__OBJECTID",de={types:{key:"type",base:V,typeMap:{wkb:A,location:U}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let i=class extends M(K(B(W(te(ie(re(X(D(H(I(N))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ye(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=O,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!S("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new y}destroy(){this.source?.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([c(()=>this.urls,t=>this.source?.updateFiles(t.items)),c(()=>this.customParameters,t=>this.source?.setCustomParameters(t))]),this}get capabilities(){return this.source?.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,o,a){const n=e.filter(l=>!(l.name===O&&l.type==="oid")).map(l=>l.toJSON(a));P(o,n,t)}get isTable(){return this.encoding==null}set renderer(e){h(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new y(e.type==="files"?e.urls:[])}writeUrls(e,t,o,a){const n=[];if(e?.length){a={blockedRelativeUrls:a?.blockedRelativeUrls};for(let l of e)l=j(l,a),l&&n.push(l)}n.length?t.source={type:"files",urls:n}:a.messages?.push(new T("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return pe(this,e)}createQuery(){const e=new g;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new p({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const o=await this.source.queryFeatures(this._normalizeQuery(e),t),a=this.graphicOrigin;if(o?.features)for(const n of o.features)n.layer=n.sourceLayer=this,n.origin=a;return o}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return g.from(e)??this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),h(this.renderer,this.fieldsIndex),R(this.timeInfo,this.fieldsIndex),this.spatialReference==null&&(this.spatialReference=J.WGS84)}};r([s({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([s({type:String})],i.prototype,"copyright",void 0),r([s({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([s()],i.prototype,"displayOptimization",void 0),r([s({type:[E],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([f("fields")],i.prototype,"writeFields",null),r([s(w.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([s(de)],i.prototype,"encoding",void 0),r([s({type:b,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([s({type:u.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:u.read},write:{writer:u.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:u.read}}}}})],i.prototype,"geometryType",void 0),r([s({readOnly:!0,clonable:!1})],i.prototype,"graphicOrigin",void 0),r([s(Y)],i.prototype,"labelsVisible",void 0),r([s({type:[ne],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ae},write:!0}})],i.prototype,"labelingInfo",void 0),r([s(Z)],i.prototype,"legendEnabled",void 0),r([s()],i.prototype,"file",void 0),r([s({type:String,readOnly:!0})],i.prototype,"objectIdField",void 0),r([s({type:["ParquetLayer"]})],i.prototype,"operationalLayerType",void 0),r([s(w.outFields)],i.prototype,"outFields",void 0),r([s(ee)],i.prototype,"popupEnabled",void 0),r([s({type:z,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([s({types:le,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],i.prototype,"renderer",null),r([s({type:p,readOnly:!0,cast:null,json:{read:!1}})],i.prototype,"source",void 0),r([s({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],i.prototype,"spatialReference",void 0),r([s({type:[se]})],i.prototype,"templates",void 0),r([s()],i.prototype,"title",void 0),r([s({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([s({type:y.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],i.prototype,"urls",void 0),r([C("urls")],i.prototype,"readUrls",null),r([f("urls")],i.prototype,"writeUrls",null),i=r([q("esri.layers.ParquetLayer")],i);const $t=i;export{$t as default};
