const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/money-tides-TidesDialog-D5YcMHN8.js","assets/money-tides-jsxFactory-_7dcBPp3.js","assets/money-tides-config-BVnrMf5g.js","assets/index-CLUlm2VH.js","assets/index-CEPnQygF.css","assets/money-tides-index-Bz5uSspo.js","assets/money-tides-runtime-BTGwkf2p.js","assets/runtime-OCMtRbrJ.css","assets/money-tides-app-config-B3LoTnI_.js","assets/money-tides-ReactiveMap-DCxoVmf-.js","assets/money-tides-messageBundle-Cp0r_61-.js","assets/money-tides-index-BSQMl5Dg.js","assets/TidesDialog-yUcdXs_A.css","assets/money-tides-PlotDialog-BDSmegZ3.js","assets/money-tides-TrafficCameraDialog-PUJKDm6r.js","assets/TrafficCameraDialog-CgGXLGGQ.css","assets/money-tides-TrafficEventDialog-DqkN_FU2.js","assets/TrafficEventDialog-DhM-Q7xU.css","assets/money-tides-DeclinationAction-Bx7E_q4x.js","assets/DeclinationAction-CtJPH1yU.css","assets/money-tides-FullscreenAction-BVImcHz1.js","assets/money-tides-SettingsAction-K_atrEKp.js","assets/SettingsAction-CESW0KY9.css","assets/money-tides-AttributionAction-f3hLkMIi.js","assets/AttributionAction-DmMpU9qe.css","assets/money-tides-AboutAction-CjgARsuG.js","assets/money-tides-LayersPanel-qe_Kl3EY.js","assets/money-tides-PanelBase-mzsUtRg3.js","assets/money-tides-AdvisoriesPanel-Da2fgI-C.js","assets/AdvisoriesPanel-DCuVDuTP.css","assets/money-tides-LunarPhasePanel-4V_qIkVx.js","assets/LunarPhasePanel-BnAYxmrE.css"])))=>i.map(i=>d[i]);
import{_ as z}from"./index-CLUlm2VH.js";import{aj as J,aD as jt,N as wt,aE as m,m as Nt,c as Bt}from"./money-tides-jsxFactory-_7dcBPp3.js";import"./money-tides-config-BVnrMf5g.js";import{l4 as Et,c5 as Ct,he as Tt,bg as Dt,af as ut,e9 as O,_ as Jt,ah as et,gu as Mt,kD as nt,kC as ot,e7 as L,l5 as Gt,l6 as Ft,l7 as Vt}from"./money-tides-app-config-B3LoTnI_.js";var ht={exports:{}},St;function Wt(){return St||(St=1,(function(t,e){(function(){var i=Math.PI,n=Math.sin,o=Math.cos,a=Math.tan,s=Math.asin,l=Math.atan2,u=Math.acos,d=i/180,f=1e3*60*60*24,_=2440588,g=2451545;function b(r){return r.valueOf()/f-.5+_}function C(r){return new Date((r+.5-_)*f)}function T(r){return b(r)-g}var M=d*23.4397;function S(r,c){return l(n(r)*o(M)-a(c)*n(M),o(r))}function P(r,c){return s(n(c)*o(M)+o(c)*n(M)*n(r))}function G(r,c,h){return l(n(r),o(r)*n(c)-a(h)*o(c))}function H(r,c,h){return s(n(c)*n(h)+o(c)*o(h)*o(r))}function k(r,c){return d*(280.16+360.9856235*r)-c}function E(r){return r<0&&(r=0),2967e-7/Math.tan(r+.00312536/(r+.08901179))}function F(r){return d*(357.5291+.98560028*r)}function Y(r){var c=d*(1.9148*n(r)+.02*n(2*r)+3e-4*n(3*r)),h=d*102.9372;return r+c+h+i}function pt(r){var c=F(r),h=Y(c);return{dec:P(h,0),ra:S(h,0)}}var I={};I.getPosition=function(r,c,h){var v=d*-h,p=d*c,w=T(r),y=pt(w),D=k(w,v)-y.ra;return{azimuth:G(D,p,y.dec),altitude:H(D,p,y.dec)}};var dt=I.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];I.addTime=function(r,c,h){dt.push([r,c,h])};var yt=9e-4;function It(r,c){return Math.round(r-yt-c/(2*i))}function vt(r,c,h){return yt+(r+c)/(2*i)+h}function _t(r,c,h){return g+r+.0053*n(c)-.0069*n(2*h)}function Rt(r,c,h){return u((n(r)-n(c)*n(h))/(o(c)*o(h)))}function $t(r){return-2.076*Math.sqrt(r)/60}function Ht(r,c,h,v,p,w,y){var D=Rt(r,h,v),A=vt(D,c,p);return _t(A,w,y)}I.getTimes=function(r,c,h,v){v=v||0;var p=d*-h,w=d*c,y=$t(v),D=T(r),A=It(D,p),R=vt(0,p,A),j=F(R),V=Y(j),Z=P(V,0),N=_t(R,j,V),W,U,B,$,q,Q,x={solarNoon:C(N),nadir:C(N-.5)};for(W=0,U=dt.length;W<U;W+=1)B=dt[W],$=(B[0]+y)*d,q=Ht($,p,w,Z,A,j,V),Q=N-(q-N),x[B[1]]=C(Q),x[B[2]]=C(q);return x};function bt(r){var c=d*(218.316+13.176396*r),h=d*(134.963+13.064993*r),v=d*(93.272+13.22935*r),p=c+d*6.289*n(h),w=d*5.128*n(v),y=385001-20905*o(h);return{ra:S(p,w),dec:P(p,w),dist:y}}I.getMoonPosition=function(r,c,h){var v=d*-h,p=d*c,w=T(r),y=bt(w),D=k(w,v)-y.ra,A=H(D,p,y.dec),R=l(n(D),a(p)*o(y.dec)-n(y.dec)*o(D));return A=A+E(A),{azimuth:G(D,p,y.dec),altitude:A,distance:y.dist,parallacticAngle:R}},I.getMoonIllumination=function(r){var c=T(r||new Date),h=pt(c),v=bt(c),p=149598e3,w=u(n(h.dec)*n(v.dec)+o(h.dec)*o(v.dec)*o(h.ra-v.ra)),y=l(p*n(w),v.dist-p*o(w)),D=l(o(h.dec)*n(h.ra-v.ra),n(h.dec)*o(v.dec)-o(h.dec)*n(v.dec)*o(h.ra-v.ra));return{fraction:(1+o(y))/2,phase:.5+.5*y*(D<0?-1:1)/Math.PI,angle:D}};function X(r,c){return new Date(r.valueOf()+c*f/24)}I.getMoonTimes=function(r,c,h,v){var p=new Date(r);v?p.setUTCHours(0,0,0,0):p.setHours(0,0,0,0);for(var w=.133*d,y=I.getMoonPosition(p,c,h).altitude-w,D,A,R,j,V,Z,N,W,U,B,$,q,Q,x=1;x<=24&&(D=I.getMoonPosition(X(p,x),c,h).altitude-w,A=I.getMoonPosition(X(p,x+1),c,h).altitude-w,V=(y+A)/2-D,Z=(A-y)/2,N=-Z/(2*V),W=(V*N+Z)*N+D,U=Z*Z-4*V*D,B=0,U>=0&&(Q=Math.sqrt(U)/(Math.abs(V)*2),$=N-Q,q=N+Q,Math.abs($)<=1&&B++,Math.abs(q)<=1&&B++,$<-1&&($=q)),B===1?y<0?R=x+$:j=x+$:B===2&&(R=x+(W<0?q:$),j=x+(W<0?$:q)),!(R&&j));x+=2)y=A;var tt={};return R&&(tt.rise=X(p,R)),j&&(tt.set=X(p,j)),!R&&!j&&(tt[W>0?"alwaysUp":"alwaysDown"]=!0),tt},t.exports=I})()})(ht)),ht.exports}var K=Wt();const At=(t,e)=>{const i=new URL(t);return Object.entries(e).forEach(([n,o])=>{i.searchParams.append(n,String(o))}),i.toString()},Pt=t=>{const e=Number(gt(t).toFixed(0));return e===0?"South":e===90?"West":e===-90?"East":e===180||e===-180?"North":e>0&&e<90?`S ${e}° W`:e>90?`N ${e-90}° W`:e<0&&e>-90?`S ${Math.abs(e)}° E`:e<-90?`N ${Math.abs(e)-90}° E`:"invalid azimuth"},oe=async(t,e,i)=>{try{const n=At("https://www.ngdc.noaa.gov/geomag-web/calculators/calculateDeclination",{key:"zNEw7",lat1:e,lon1:i,model:"WMM",startYear:t.get("year"),startMonth:t.get("month"),startDay:t.get("day"),resultFormat:"json"}),a=(await(await fetch(n)).json()).result[0].declination,s=Math.abs(a),l=a>0?"E":"W";return{bearing:a===0?"0°":`${Math.floor(s)}° ${Math.floor((s-Math.floor(s))*60)}' ${l}`,declination:a}}catch(n){return console.log(n),{bearing:"invalid",declination:-999}}},qt=t=>t<=.05?"New Moon":t>.05&&t<.2?"Waxing Crescent":t>=.2&&t<=.3?"First Quarter":t>.3&&t<.45?"Waxing Gibbous":t>=.45&&t<=.55?"Full Moon":t>.55&&t<.7?"Waning Gibbous":t>=.7&&t<=.8?"Last Quarter":t>.8?"Waning Crescent":"Invalid Phase",gt=t=>t*180/Math.PI,at=(t,e,i)=>{const n=t.toJSDate(),{rise:o,set:a}=K.getMoonTimes(n,e,i),{distance:s}=K.getMoonPosition(n,e,i),{fraction:l,phase:u}=K.getMoonIllumination(n),{nadir:d,solarNoon:f,sunrise:_,sunset:g}=K.getTimes(n,e,i);return{moon:{distance:s,distanceFromAverage:-(s-384400),illumination:l,illuminationPercent:`${(l*100).toFixed(0)}%`,moonrise:o?J.fromJSDate(o):void 0,moonset:a?J.fromJSDate(a):void 0,phase:u,phaseName:qt(u)},sun:{nadir:J.fromJSDate(d),solarNoon:J.fromJSDate(f),sunrise:J.fromJSDate(_),sunset:J.fromJSDate(g)}}},it=(t,e,i)=>{const n=t.toJSDate(),{moon:{moonrise:o,moonset:a},sun:{sunrise:s,sunset:l}}=at(t,e,i),{altitude:u,azimuth:d}=K.getMoonPosition(n,e,i),{altitude:f,azimuth:_}=K.getPosition(n,e,i),g=t.toMillis(),b=o&&g===o.toMillis()||a&&g===a.toMillis(),C=g===s.toMillis()||g===l.toMillis(),T=gt(u),M=gt(f);return{moonPosition:{aboveHorizon:b?!0:u>0,altitude:T,altitudeDegrees:b?"0°":`${T.toFixed(0)}°`,azimuth:d,azimuthBearing:Pt(d),type:"moon"},sunPosition:{aboveHorizon:C?!0:f>0,altitude:M,altitudeDegrees:C?"0°":`${M.toFixed(0)}°`,azimuth:_,azimuthBearing:Pt(_),type:"sun"}}},Yt="M10.5 7.095h-.008a6.76 6.76 0 0 0-.848.108c-.022-.471-.41-1.05-.887-1.05a.892.892 0 0 0-.892.892.883.883 0 0 0 .139.467 5.507 5.507 0 0 0-1.13.678.153.153 0 0 0-.064-.136c-.015-.01-1.377-.948-1.336-2.065a3.838 3.838 0 0 0 2.502-.523c.361-.286.867-.675.912-1.158a.155.155 0 0 0-.21-.159 8.942 8.942 0 0 1-2.167.409 4.498 4.498 0 0 1 1.95-2.225.173.173 0 0 0 .097-.165.155.155 0 0 0-.137-.134c-.14-.016-3.642.64-4.108 2.533-.494 2.005.206 2.911.248 2.963l1.59 1.367a4.28 4.28 0 0 0-.482.737c-.422-.206-1.94-.811-2.118-1.435a12.964 12.964 0 0 1-.92-2.796.152.152 0 0 0-.162-.12.155.155 0 0 0-.144.14 8.124 8.124 0 0 0 .197 3.46c.054.07 1.829 1.601 3.075 1.668.032.14.074.496.128.662-.493-.118-1.837-.433-2.373-.487a.15.15 0 0 0-.153.08 12.457 12.457 0 0 0-1.17 2.863 5.375 5.375 0 0 0 .002 1.201.155.155 0 0 0 .13.128l.023.001a.155.155 0 0 0 .139-.087l1.482-3.042a19.099 19.099 0 0 0 2.418.422h.005a4.8 4.8 0 0 0 .23.337 4.961 4.961 0 0 0-1.987.747 2.575 2.575 0 0 0-.544 1.912c0 .876 1.259 1.618 1.436 1.655a.16.16 0 0 0 .031.003.155.155 0 0 0 .107-.267 3.57 3.57 0 0 1-.74-1.523 3.68 3.68 0 0 1 .221-.943l2.13-.775a.151.151 0 0 0 .07-.052 4.608 4.608 0 0 0 .59.41L6.33 15.064a.155.155 0 0 0-.04.178c.033.076 1.222 2.465 2.265 2.605a3.554 3.554 0 0 0 .625.075 3.156 3.156 0 0 0 .474-.028.155.155 0 0 0 .042-.292 6.336 6.336 0 0 1-1.895-1.837l-.154-.36 1.09-1.171a6.87 6.87 0 0 0 1.763.337 6.87 6.87 0 0 0 1.763-.337l1.09 1.171-.154.36a6.336 6.336 0 0 1-1.895 1.837.155.155 0 0 0 .042.292 3.156 3.156 0 0 0 .474.028 3.554 3.554 0 0 0 .625-.075c1.043-.14 2.232-2.529 2.265-2.605a.155.155 0 0 0-.04-.178l-1.443-1.268a4.608 4.608 0 0 0 .592-.41.151.151 0 0 0 .069.052l2.13.775a3.68 3.68 0 0 1 .221.943 3.57 3.57 0 0 1-.74 1.523.155.155 0 0 0 .107.267.16.16 0 0 0 .03-.003c.178-.037 1.437-.779 1.437-1.655a2.575 2.575 0 0 0-.544-1.912 4.961 4.961 0 0 0-1.987-.747 4.8 4.8 0 0 0 .23-.337h.005a19.099 19.099 0 0 0 2.418-.422l1.482 3.042a.155.155 0 0 0 .14.087l.022-.001a.155.155 0 0 0 .13-.128 5.375 5.375 0 0 0 .002-1.2 12.457 12.457 0 0 0-1.17-2.863.15.15 0 0 0-.153-.081c-.536.054-1.88.369-2.373.487.054-.166.096-.521.128-.662 1.246-.067 3.02-1.598 3.075-1.668a8.124 8.124 0 0 0 .197-3.46.155.155 0 0 0-.144-.14.152.152 0 0 0-.162.12 12.964 12.964 0 0 1-.92 2.796c-.178.624-1.696 1.23-2.118 1.435a4.28 4.28 0 0 0-.483-.737l1.59-1.367c.043-.052.743-.958.25-2.963-.467-1.893-3.97-2.549-4.11-2.533a.155.155 0 0 0-.136.134.173.173 0 0 0 .098.165 4.498 4.498 0 0 1 1.95 2.225 8.942 8.942 0 0 1-2.168-.409.155.155 0 0 0-.21.16c.045.482.55.871.912 1.157a3.838 3.838 0 0 0 2.502.523c.04 1.117-1.321 2.056-1.336 2.065a.153.153 0 0 0-.065.136 5.507 5.507 0 0 0-1.129-.678.883.883 0 0 0 .139-.467.892.892 0 0 0-.892-.891c-.477 0-.865.578-.887 1.05a6.76 6.76 0 0 0-.848-.109z",kt=new Ct({size:12,outline:{width:0},path:Yt}),lt=new Ct({style:"circle",size:18,outline:{width:1}}),Ot=new Tt({font:{size:12},haloSize:1.75,horizontalAlignment:"left",verticalAlignment:"middle",xoffset:12}),Lt=new Tt({font:{size:12},haloSize:1.75,horizontalAlignment:"left",verticalAlignment:"top",xoffset:12,yoffset:-9}),Zt=t=>{const{money:e,name:i,tides:n}=t,{primary:o,secondary:a}=Et(e),s=Object.assign(kt.clone(),{color:o}),l=Object.assign(lt.clone(),{color:a,outline:{color:o,width:lt.outline.width}}),u=Object.assign(Ot.clone(),{color:o,haloColor:a,text:i}),d=Object.assign(Lt.clone(),{color:o,haloColor:a,text:xt(n)});return{crabSymbol:s,markerSymbol:l,stationSymbol:u,tidesSymbol:d}},xt=t=>t.filter(e=>e.isPrediction&&e.isDate).map(e=>{const{heightLabel:i,time:n,type:o}=e;return`${n} ${o} ${i}`}).join(`
`),Ut=t=>{const{error:e,money:i,name:n,tides:o}=t;let{primary:a,secondary:s}=Et(i);e&&(a=new Dt("black"),s=new Dt("white"));const l=Object.assign(kt.clone(),{color:a}),u=Object.assign(lt.clone(),{color:s,outline:{color:a,width:lt.outline.width}}),d=Object.assign(Ot.clone(),{color:a,haloColor:s,text:n}),f=Object.assign(Lt.clone(),{color:e?null:a,haloColor:e?null:s,text:xt(o)});return{crabSymbol:l,markerSymbol:u,stationSymbol:d,tidesSymbol:f}};var Qt=Object.defineProperty,Kt=Object.getOwnPropertyDescriptor,zt=(t,e,i,n)=>{for(var o=n>1?void 0:n?Kt(e,i):e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(o=(n?s(e,i,o):s(o))||o);return n&&o&&Qt(e,i,o),o};const st=(t,e)=>{const i=t.filter(b=>b.isPrediction),n=-999;let o;if(i.forEach(b=>{b.date.toMillis()<e.toMillis()&&(o=b)}),!o)return n;const a=i[i.indexOf(o)+1];if(!a)return n;const{date:s,height:l}=o,{date:u,height:d}=a,f=s.toMillis(),_=u.toMillis(),g=e.toMillis();return g<f&&g<_||g>f&&g>_?n:Number((l+(d-l)*(g-f)/(_-f)).toFixed(2))},rt="money-tides",mt={header:`${rt}_header`,headerDate:`${rt}_header--date`,view:`${rt}_view`};let ft=0,ct=class extends jt{constructor(t){super(t),this._container=document.createElement("calcite-shell"),this.alerts=new ut,this.panelHideMethods=[],this.stations=new ut,this.visiblePanel=null,this.zoomToDropdownItems=new ut,this.container=this._container,document.body.appendChild(this.container);const{zoomToDropdownItems:e}=this;this.addHandles([wt(()=>L.colorType,()=>{this.stations.forEach(this.updateGraphics.bind(this))}),e.on("after-add",()=>{e.sort((i,n)=>i.name<n.name?-1:i.name>n.name?1:0)})])}get container(){return this._container}set container(t){this._container=t}addZoomToItem(t,e){this.zoomToDropdownItems.add({name:e,element:m("calcite-dropdown-item",{"icon-start":"pin-tear",key:ft++,onclick:()=>{const i=this.stations.find(n=>n.id===t);i&&(O.goTo(i.graphics.markerGraphic),O.scale=6e4,this.tidesDialog?.open(i))}},e)})}createGraphics(t){const{graphics:e}=O,{id:i,latitude:n,longitude:o,money:a,name:s,tides:l}=t,{crabSymbol:u,markerSymbol:d,stationSymbol:f,tidesSymbol:_}=Zt({money:a,name:s,tides:l}),g={id:i},b=new Jt({latitude:n,longitude:o}),C=new et({attributes:g,geometry:b,symbol:u}),T=new et({attributes:g,geometry:b,symbol:d}),M=new et({attributes:g,geometry:b,symbol:f}),S=new et({attributes:g,geometry:b,symbol:_,visible:O.scale<24e4});return this.addHandles(wt(()=>O.scale,()=>{S.visible=O.scale<24e4})),e.addMany([T,C,M,S]),{crabGraphic:C,markerGraphic:T,stationGraphic:M,tidesGraphic:S}}async getTides(t){const{date:e,id:i,latitude:n,longitude:o}=t,a=e.minus({day:1}),s=e.plus({day:1}),u=(await(await fetch(At("https://api.tidesandcurrents.noaa.gov/api/prod/datagetter",{product:"predictions",format:"json",interval:"hilo",time_zone:"lst_ldt",units:"english",datum:"mllw",station:i,begin_date:Mt(a),end_date:Mt(s)}))).json()).predictions.map(S=>{const{t:P,v:G,type:H}=S,k=J.fromSQL(P).setZone("America/Los_Angeles"),E=Number(Number(G).toFixed(2));return{date:k,height:E,heightLabel:`${E} ft`,isDate:e.hasSame(k,"day"),isLunar:!1,isPrediction:!0,isSolar:!1,money:"not-money",...it(k,n,o),time:nt(k),type:H==="H"?"high tide":"low tide"}}),d=this.money(u),{moon:f,sun:_}=at(a,n,o),{moon:g,sun:b}=at(e,n,o),{moon:C,sun:T}=at(s,n,o),M=[{date:_.nadir,event:"solar nadir",type:"solar"},{date:_.solarNoon,event:"solar noon",type:"solar"},{date:_.sunrise,event:"sunrise",type:"solar"},{date:_.sunset,event:"sunset",type:"solar"},{date:b.nadir,event:"solar nadir",type:"solar"},{date:b.solarNoon,event:"solar noon",type:"solar"},{date:b.sunrise,event:"sunrise",type:"solar"},{date:b.sunset,event:"sunset",type:"solar"},{date:T.nadir,event:"solar nadir",type:"solar"},{date:T.solarNoon,event:"solar noon",type:"solar"},{date:T.sunrise,event:"sunrise",type:"solar"},{date:T.sunset,event:"sunset",type:"solar"}];return f.moonrise&&M.push({date:f.moonrise,event:"moonrise",type:"lunar"}),f.moonset&&M.push({date:f.moonset,event:"moonset",type:"lunar"}),g.moonrise&&M.push({date:g.moonrise,event:"moonrise",type:"lunar"}),g.moonset&&M.push({date:g.moonset,event:"moonset",type:"lunar"}),C.moonrise&&M.push({date:C.moonrise,event:"moonrise",type:"lunar"}),C.moonset&&M.push({date:C.moonset,event:"moonset",type:"lunar"}),M.forEach(S=>{const{date:P,event:G,type:H}=S,k=st(u,P);u.push({date:P,height:k,heightLabel:`${k} ft`,isDate:e.hasSame(P,"day"),isLunar:H==="lunar",isPrediction:!1,isSolar:H==="solar",money:"not-money",...it(P,n,o),time:nt(P),type:G})}),u.sort((S,P)=>S.date.toMillis()-P.date.toMillis()),u.filter(S=>S.isLunar).forEach((S,P,G)=>{const{date:H,type:k}=S;let E,F;if(k==="moonrise"){const Y=G[P+1];Y&&(E=J.fromMillis(Math.floor((H.toMillis()+Y.date.toMillis())/2)),F=st(u,E),u.push({date:E,height:F,heightLabel:`${F} ft`,isDate:e.hasSame(E,"day"),isLunar:!0,isPrediction:!1,isSolar:!1,money:"not-money",...it(E,n,o),time:nt(E),type:"lunar noon"}))}if(k==="moonset"){const Y=G[P+1];Y&&(E=J.fromMillis(Math.floor((H.toMillis()+Y.date.toMillis())/2)),F=st(u,E),u.push({date:E,height:F,heightLabel:`${F} ft`,isDate:e.hasSame(E,"day"),isLunar:!0,isPrediction:!1,isSolar:!1,money:"not-money",...it(E,n,o),time:nt(E),type:"lunar nadir"}))}}),u.sort((S,P)=>S.date.toMillis()-P.date.toMillis()),{money:d,moon:g,sun:b,tides:u}}getTimeRange(t){if(!t)return 0;const e=t.toMillis();return e>=ot(t,{hour:11}).toMillis()&&e<=ot(t,{hour:13}).toMillis()?2:e>=ot(t,{hour:10}).toMillis()&&e<=ot(t,{hour:14}).toMillis()?1:0}async loadStation(t){try{const{id:e,latitude:i,longitude:n,name:o,weather:a}=t,s=L.date,{money:l,moon:u,sun:d,tides:f}=await this.getTides({date:s,id:e,latitude:i,longitude:n});this.stations.add({date:s,error:!1,errorCount:0,graphics:this.createGraphics({id:e,latitude:i,longitude:n,money:l,name:o,tides:f}),id:e,latitude:i,longitude:n,name:o,money:l,moon:u,sun:d,tides:f,weather:a}),this.addZoomToItem(e,o),t.loaded=!0}catch(e){if(console.log("load error",e),t.errorCount!==10){t.errorCount++,setTimeout(()=>{this.loadStation(t)},t.errorCount*50);return}const i=`station-error-alert-${t.id}`,n=this.container.querySelector(`#${i}`);if(n){n.open=!0;return}this.alerts.add(m("calcite-alert",{"auto-close":"","auto-close-duration":"fast",icon:"exclamation-mark-triangle",id:i,key:ft++,kind:"danger",open:!0,scale:L.scale,slot:"alerts"},m("div",{slot:"title"},"Error"),m("div",{slot:"message"},"Failed to load station data for ",t.name)))}}money(t){const e=t.filter(s=>s.isDate).toSorted((s,l)=>l.height-s.height),i=e[0],n=e[1].type==="high tide"?e[1]:null,o=this.getTimeRange(i.date),a=this.getTimeRange(n?.date);return o===2?(t[t.indexOf(i)].money="money","money"):o===1?(t[t.indexOf(i)].money="mostly-money","mostly-money"):a===2&&n?(t[t.indexOf(n)].money="kinda-money","kinda-money"):a===1&&n?(t[t.indexOf(n)].money="potentially-money","potentially-money"):"not-money"}updateGraphics(t){const{error:e,graphics:{crabGraphic:i,markerGraphic:n,stationGraphic:o,tidesGraphic:a},money:s,name:l,tides:u}=t,{crabSymbol:d,markerSymbol:f,stationSymbol:_,tidesSymbol:g}=Ut({error:e,money:s,name:l,tides:u});i.symbol=d,n.symbol=f,o.symbol=_,a.symbol=g}async updateStation(t){const e=L.date,{id:i,latitude:n,longitude:o}=t;try{const{money:a,moon:s,sun:l,tides:u}=await this.getTides({date:e,id:i,latitude:n,longitude:o});Object.assign(t,{date:e,money:a,moon:s,sun:l,tides:u}),t.error=!1,t.errorCount=0,this.updateGraphics(t),this.tidesDialog&&this.tidesDialog.container.open&&this.tidesDialog.station.id===i&&this.tidesDialog.open(t);const d=this.container.querySelector(`#station-error-alert-${i}`);d&&(d.open=!1)}catch(a){if(console.log("update error",a),t.error=!0,this.updateGraphics(t),t.errorCount!==10){t.errorCount++,setTimeout(()=>{this.updateStation(t)},t.errorCount*50);return}const s=`station-error-alert-${t.id}`,l=this.container.querySelector(`#${s}`);if(l){l.open=!0;return}t.errorCount=0,this.tidesDialog&&this.tidesDialog.container.open&&this.tidesDialog.station.id===i&&this.tidesDialog.close(),this.alerts.add(m("calcite-alert",{"auto-close":"","auto-close-duration":"fast",icon:"exclamation-mark-triangle",id:s,key:ft++,kind:"danger",open:!0,scale:L.scale,slot:"alerts"},m("div",{slot:"title"},"Error"),m("div",{slot:"message"},"Failed to load station data for ",t.name)))}}dateChangeEvent(t){L.date=Gt(J.fromISO(t.target.value).setZone("America/Los_Angeles")),this.stations.forEach(this.updateStation.bind(this))}dateButtonClickEvent(t){const e=t.target.iconStart,i=L.date=e==="chevron-right"?L.date.plus({days:1}):L.date.minus({days:1});this.datePicker.value=i.toISODate(),this.datePicker.dispatchEvent(new Event("calciteInputDatePickerChange"))}actionClickEvent(t){if(!t){for(const e of this.panelHideMethods)e();this.visiblePanel=null;return}if(t&&this.visiblePanel===t){t.hide(),this.visiblePanel=null;return}t&&this.visiblePanel!==t&&this.visiblePanel?.hide(),this.tidesDialog?.close(),t.show(),this.visiblePanel=t}async viewClickEvent(t){t.stopPropagation();const{tidesDialog:e,trafficCameraDialog:i,trafficEventDialog:n}=this,{cameras:o,events:a}=Ft.graphicsLayers,l=(await O.hitTest(t,{include:[O.graphics,o.graphics,a.graphics]})).results[0];if(!l||l.type!=="graphic"){e?.close(),i?.close(),n?.close();return}if(!l.layer){if(i?.close(),n?.close(),!e){this.tidesDialog=new(await z(async()=>{const{default:f}=await import("./money-tides-TidesDialog-D5YcMHN8.js");return{default:f}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))).default({container:document.getElementById("tides-dialog")});const d=new(await z(async()=>{const{default:f}=await import("./money-tides-PlotDialog-BDSmegZ3.js");return{default:f}},__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11]))).default;this.addHandles(this.tidesDialog.on("plot-tides",d.open.bind(d)))}const u=this.stations.find(d=>d.id===l.graphic.attributes.id);if(!u||u&&u.error)return;this.tidesDialog?.open(u)}l.layer===o&&(e?.close(),n?.close(),i||(this.trafficCameraDialog=new(await z(async()=>{const{default:u}=await import("./money-tides-TrafficCameraDialog-PUJKDm6r.js");return{default:u}},__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,15]))).default({container:document.getElementById("traffic-camera-dialog")})),this.trafficCameraDialog?.open(l.graphic.attributes.filename,l.graphic.attributes.title)),l.layer===a&&(e?.close(),i?.close(),n||(this.trafficEventDialog=new(await z(async()=>{const{default:u}=await import("./money-tides-TrafficEventDialog-DqkN_FU2.js");return{default:u}},__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,17]))).default({container:document.getElementById("traffic-event-dialog")})),this.trafficEventDialog?.open(l.graphic.attributes)),this.actionClickEvent(null)}render(){const t=L.scale,{alerts:e,visiblePanel:i,zoomToDropdownItems:n}=this,o=i===this.lunarPhasePanel?"--calcite-shell-panel-min-width: 260px;":"";return m("calcite-shell",{class:rt,"content-behind":""},m("div",{class:mt.header,slot:"header"},m("div",{class:mt.headerDate},m("calcite-button",{"icon-start":"chevron-left",scale:t,onclick:this.dateButtonClickEvent.bind(this)}),m("calcite-input-date-picker",{"overlay-positioning":"fixed",scale:t,afterCreate:this.datePickerAfterCreate.bind(this)}),m("calcite-button",{"icon-start":"chevron-right",scale:t,onclick:this.dateButtonClickEvent.bind(this)}))),m("calcite-shell-panel",{"display-mode":"float-content",position:L.layout,slot:`panel-${L.layout}`,style:o},m("calcite-action-bar",{scale:t,slot:"action-bar",afterCreate:this.actionBarAfterCreate.bind(this)},m("calcite-action-group",null,m("calcite-dropdown",{placement:"left","offset-distance":"10","offset-skidding":"10",scale:t},m("calcite-action",{icon:"zoom-to-object",scale:t,slot:"trigger",text:"Zoom To",onclick:this.actionClickEvent.bind(this,null)}),m("calcite-dropdown-group",{"group-title":"Zoom to","selection-mode":"none"},n.map(a=>a.element).toArray())),m("calcite-action",{active:this.layersPanel===i,icon:"layers",scale:t,text:"Layers",onclick:this.actionClickEvent.bind(this,this.layersPanel)}),m("calcite-action",{active:this.advisoriesPanel===i,icon:"exclamation-mark-triangle",scale:t,text:"Advisories",onclick:this.actionClickEvent.bind(this,this.advisoriesPanel)}),m("calcite-action",{active:this.lunarPhasePanel===i,icon:"moon",scale:t,text:"Lunar Phase",onclick:this.actionClickEvent.bind(this,this.lunarPhasePanel)}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async a=>{new(await z(async()=>{const{default:s}=await import("./money-tides-DeclinationAction-Bx7E_q4x.js");return{default:s}},__vite__mapDeps([18,1,2,3,4,5,6,7,8,9,10,11,19]))).default({container:a})}})),m("calcite-action-group",{slot:"actions-end"},m("calcite-action",{afterCreate:async a=>{new(await z(async()=>{const{default:s}=await import("./money-tides-FullscreenAction-BVImcHz1.js");return{default:s}},__vite__mapDeps([20,1,2,3,4,5,6,7,8,9,10,11]))).default({container:a})}}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async a=>{new(await z(async()=>{const{default:s}=await import("./money-tides-SettingsAction-K_atrEKp.js");return{default:s}},__vite__mapDeps([21,1,2,3,4,5,6,7,8,9,10,11,22]))).default({container:a})}}),m("calcite-action",{onclick:this.actionClickEvent.bind(this,null),afterCreate:async a=>{new(await z(async()=>{const{default:s}=await import("./money-tides-AttributionAction-f3hLkMIi.js");return{default:s}},__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,24]))).default({container:a})}}),m("calcite-action",{afterCreate:async a=>{new(await z(async()=>{const{default:s}=await import("./money-tides-AboutAction-CjgARsuG.js");return{default:s}},__vite__mapDeps([25,3,4,1,2,5,6,7,8,9,10,11]))).default({container:a})}}))),m("calcite-panel",{afterCreate:async a=>{const s=this.layersPanel=new(await z(async()=>{const{default:l}=await import("./money-tides-LayersPanel-qe_Kl3EY.js");return{default:l}},__vite__mapDeps([26,3,4,1,2,5,6,7,27,8,9,10,11]))).default({container:a});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}}),m("calcite-panel",{afterCreate:async a=>{const s=this.advisoriesPanel=new(await z(async()=>{const{default:l}=await import("./money-tides-AdvisoriesPanel-Da2fgI-C.js");return{default:l}},__vite__mapDeps([28,3,4,1,2,5,6,7,27,8,9,10,11,29]))).default({container:a});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}}),m("calcite-panel",{afterCreate:async a=>{const s=this.lunarPhasePanel=new(await z(async()=>{const{default:l}=await import("./money-tides-LunarPhasePanel-4V_qIkVx.js");return{default:l}},__vite__mapDeps([30,1,2,3,4,5,6,7,27,8,9,10,11,31]))).default({container:a});this.panelHideMethods.push(s.hide.bind(s)),this.addHandles(s.on("close",()=>{this.visiblePanel=null}))}})),e.toArray(),m("calcite-dialog",{id:"tides-dialog",slot:"dialogs"}),m("calcite-dialog",{id:"traffic-camera-dialog",slot:"dialogs"}),m("calcite-dialog",{id:"traffic-event-dialog",slot:"dialogs"}),m("div",{class:mt.view,afterCreate:this.viewAfterCreate.bind(this)}))}actionBarAfterCreate(t){const e=()=>{const i=t.getBoundingClientRect().width;O.padding={...O.padding,right:i}};e(),new ResizeObserver(()=>{e()}).observe(t)}datePickerAfterCreate(t){const e=L.date.toISODate();t.value=e,t.addEventListener("calciteInputDatePickerChange",this.dateChangeEvent.bind(this)),this.datePicker=t}async viewAfterCreate(t){O.container=t,O.ui.remove(["attribution","zoom"]);for(const e of Vt)Object.assign(e,{errorCount:0,loaded:!1}),this.loadStation(e);this.addHandles(O.on("click",this.viewClickEvent.bind(this))),this.emit("loaded")}};zt([Nt()],ct.prototype,"visiblePanel",2);ct=zt([Bt("MoneyTides")],ct);const ie=Object.freeze(Object.defineProperty({__proto__:null,get default(){return ct},tideHeight:st},Symbol.toStringTag,{value:"Module"}));export{ie as M,At as c,oe as m,at as s,st as t};
